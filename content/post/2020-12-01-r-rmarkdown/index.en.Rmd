---
title: "The R Markdown document for VAERS analysis"
author: "Dr. Jessica Rose"
date: "2021-05-21"
output: html_document
---

This is an R Markdown sheet generated from the VAERS data. I included some code but for the most part, only figures are shown. I decided to show figures pertaining to Death, Spontaneous abortions, Breakthrough COVID-19 infections and Cardiovascular, Neurological and Immunological adverse events.

I start by coalescing the .csv files downloaded from the VAERS website: https://vaers.hhs.gov/data/datasets.html
```{r global-options, include=FALSE}
knitr::opts_chunk$set(fig.width=7, fig.height=5, fig.path='Figs/',
                      echo=FALSE, warning=FALSE, message=FALSE)
```
```{r}
library("readr")
library("tidyverse")
library("dplyr")
library("ggplot2")
library("stringr")
library("DT")
library("reshape2")
library("data.table")
library("plotly")
```
```{r}
VAERSSYM_2021_paper <- read_csv("/Users/admin/Downloads/2021VAERSData_06_04_21_191800kb/2021VAERSSYMPTOMS.csv", col_types = cols(VAERS_ID = col_double()))
RV_06_04_21_191800kb <- VAERSSYM_2021_paper %>% select(VAERS_ID, SYMPTOM1, SYMPTOM2, SYMPTOM3, SYMPTOM4, SYMPTOM5)
```
```{r}
SYMPTOM1_LIST_06_04_21_191800kb <- RV_06_04_21_191800kb %>% select(VAERS_ID, SYMPTOM1) %>% rename(SYMPTOM = SYMPTOM1) %>% filter(SYMPTOM != "NA")
Total_number_SYMPTOM1_LIST_06_04_21_191800kb <- SYMPTOM1_LIST_06_04_21_191800kb %>% group_by(VAERS_ID, SYMPTOM) %>% count(SYMPTOM)
SYMPTOM2_LIST_06_04_21_191800kb <- RV_06_04_21_191800kb %>% select(VAERS_ID, SYMPTOM2) %>% rename(SYMPTOM = SYMPTOM2) %>% filter(SYMPTOM != "NA")
Total_number_SYMPTOM2_LIST_06_04_21_191800kb <- SYMPTOM2_LIST_06_04_21_191800kb %>% group_by(VAERS_ID, SYMPTOM) %>% count(SYMPTOM)
SYMPTOM3_LIST_06_04_21_191800kb <- RV_06_04_21_191800kb %>% select(VAERS_ID, SYMPTOM3) %>% rename(SYMPTOM = SYMPTOM3) %>% filter(SYMPTOM != "NA")
Total_number_SYMPTOM3_LIST_06_04_21_191800kb <- SYMPTOM3_LIST_06_04_21_191800kb %>% group_by(VAERS_ID, SYMPTOM) %>% count(SYMPTOM)
SYMPTOM4_LIST_06_04_21_191800kb <- RV_06_04_21_191800kb %>% select(VAERS_ID, SYMPTOM4) %>% rename(SYMPTOM = SYMPTOM4) %>% filter(SYMPTOM != "NA")
Total_number_SYMPTOM4_LIST_06_04_21_191800kb <- SYMPTOM4_LIST_06_04_21_191800kb %>% group_by(VAERS_ID, SYMPTOM) %>% count(SYMPTOM)
SYMPTOM5_LIST_06_04_21_191800kb <- RV_06_04_21_191800kb %>% select(VAERS_ID, SYMPTOM5) %>% rename(SYMPTOM = SYMPTOM5) %>% filter(SYMPTOM != "NA")
Total_number_SYMPTOM5_LIST_06_04_21_191800kb <- SYMPTOM5_LIST_06_04_21_191800kb %>% group_by(VAERS_ID, SYMPTOM) %>% count(SYMPTOM)
```
```{r}
ALL_SYMPTOMS_06_04_21_191800kb <- rbind(SYMPTOM1_LIST_06_04_21_191800kb, SYMPTOM2_LIST_06_04_21_191800kb, SYMPTOM3_LIST_06_04_21_191800kb, SYMPTOM4_LIST_06_04_21_191800kb, SYMPTOM5_LIST_06_04_21_191800kb)
```
```{r}
VAERSDATA_06_04_21_191800kb <- read.csv("/Users/admin/Downloads/2021VAERSData_06_04_21_191800kb/2021VAERSDATA.csv", stringsAsFactors = FALSE)
RV_DATA_06_04_21_191800kb <- VAERSDATA_06_04_21_191800kb %>% select(VAERS_ID, STATE, AGE_YRS,	SEX,	DIED,	DATEDIED,	HOSPITAL,	VAX_DATE,	ONSET_DATE,	TODAYS_DATE, ER_ED_VISIT, L_THREAT, DISABLE, BIRTH_DEFECT) 
#RV_DATA_06_04_21_191800kb

RV_DATA_06_04_21_191800kb$VAX_DATE <- as.Date(RV_DATA_06_04_21_191800kb$VAX_DATE, "%m/%d/%y") 
RV_DATA_06_04_21_191800kb$ONSET_DATE <- as.Date(RV_DATA_06_04_21_191800kb$ONSET_DATE, "%m/%d/%y")
RV_DATA_06_04_21_191800kb$DATEDIED <- as.Date(RV_DATA_06_04_21_191800kb$DATEDIED, "%m/%d/%y")
RV_DATA_06_04_21_191800kb$TODAYS_DATE <- as.Date(RV_DATA_06_04_21_191800kb$TODAYS_DATE, "%m/%d/%y")
```
```{r}
VAERSVAX_06_04_21_191800kb <- read_csv("/Users/admin/Downloads/2021VAERSData_06_04_21_191800kb/2021VAERSVAX.csv", col_types = cols(VAERS_ID = col_double()))
RV_VAX_06_04_21_191800kb <- VAERSVAX_06_04_21_191800kb %>% select(VAERS_ID, VAX_TYPE, VAX_MANU, VAX_LOT, VAX_DOSE_SERIES, VAX_ROUTE, VAX_SITE, VAX_NAME) %>% filter(VAX_TYPE == "COVID19")
```
```{r}
MERGED_SYM_DAT_06_04_21_191800kb <- full_join(ALL_SYMPTOMS_06_04_21_191800kb, RV_DATA_06_04_21_191800kb, by = c("VAERS_ID"))
MERGED_SYM_DAT_VAX_06_04_21_191800kb <- full_join(MERGED_SYM_DAT_06_04_21_191800kb, RV_VAX_06_04_21_191800kb, by = c("VAERS_ID"))
MERGED_SYM_DAT_VAX_06_04_21_191800kb <- subset(MERGED_SYM_DAT_VAX_06_04_21_191800kb, !duplicated(subset(MERGED_SYM_DAT_VAX_06_04_21_191800kb, select=c(VAERS_ID))))
MERGED_SYM_DAT_VAX_06_04_21_191800kb_count_sym <- MERGED_SYM_DAT_VAX_06_04_21_191800kb %>% group_by(SYMPTOM) %>% count(SYMPTOM) %>% arrange(desc(n))
#MERGED_SYM_DAT_VAX_06_04_21_191800kb_count_sym
MERGED_SYM_DAT_VAX_06_04_21_191800kb_female <- MERGED_SYM_DAT_VAX_06_04_21_191800kb %>% group_by(SEX) %>% count(SEX) %>% mutate("PERC_FEMALE" = n/nrow(MERGED_SYM_DAT_VAX_06_04_21_191800kb)*100)
#MERGED_SYM_DAT_VAX_06_04_21_191800kb_female
#MERGED_SYM_DAT_VAX_06_04_21_191800kb
```
```{r}
D_06_04_21_191800kb <- MERGED_SYM_DAT_VAX_06_04_21_191800kb %>% group_by(VAERS_ID, DIED) %>% filter(DIED == "Y")
DEAD_06_04_21_191800kb <- subset(D_06_04_21_191800kb, !duplicated(subset(D_06_04_21_191800kb, select=c(VAERS_ID))))
#nrow(DEAD_06_04_21_191800kb)
```
```{r}
DEAD_Y_06_04_21_191800kb <- MERGED_SYM_DAT_VAX_06_04_21_191800kb %>% group_by(DIED) %>% filter(DIED == "Y")
HOSPITAL_Y_06_04_21_191800kb <- MERGED_SYM_DAT_VAX_06_04_21_191800kb %>% group_by(HOSPITAL) %>% filter(HOSPITAL == "Y")
ER_ED_Y_06_04_21_191800kb <- MERGED_SYM_DAT_VAX_06_04_21_191800kb %>% group_by(ER_ED_VISIT) %>% filter(ER_ED_VISIT == "Y")
L_THREAT_Y_06_04_21_191800kb <- MERGED_SYM_DAT_VAX_06_04_21_191800kb %>% group_by(L_THREAT) %>% filter(L_THREAT == "Y")
DISABLE_Y_06_04_21_191800kb <- MERGED_SYM_DAT_VAX_06_04_21_191800kb %>% group_by(DISABLE) %>% filter(DISABLE == "Y")
BIRTH_DEFECT_Y_06_04_21_191800kb <- MERGED_SYM_DAT_VAX_06_04_21_191800kb %>% group_by(BIRTH_DEFECT) %>% filter(BIRTH_DEFECT == "Y")

SAES_06_04_21_191800kb <- rbind(DEAD_Y_06_04_21_191800kb, HOSPITAL_Y_06_04_21_191800kb, ER_ED_Y_06_04_21_191800kb, L_THREAT_Y_06_04_21_191800kb, DISABLE_Y_06_04_21_191800kb, BIRTH_DEFECT_Y_06_04_21_191800kb)

SAES_no_dups_06_04_21_191800kb <- subset(SAES_06_04_21_191800kb, !duplicated(subset(SAES_06_04_21_191800kb, select=c(VAERS_ID))))
nrow(SAES_no_dups_06_04_21_191800kb)
Percent = nrow(SAES_no_dups_06_04_21_191800kb)/nrow(MERGED_SYM_DAT_VAX_06_04_21_191800kb)*100
#Percent
```
ACTUAL REPORTED SEVERE ADVERSE EVENTS (SAE) COMPARED TO VAERS STANDARD (15%) - IT IS STILL CONSISTENTLY HIGHER AND PEAKED AT 57%
```{r}
Table_SAEs <- data.frame(
  Percent_SAE = c("Standard", "Actual"),
  SAE = as.numeric(c("43000", "51068")),
  
  stringsAsFactors = FALSE
)
Table_SAEs_perc <- Table_SAEs %>% mutate("PERC" = round(SAE/(nrow(MERGED_SYM_DAT_VAX_06_04_21_191800kb))*100))
#head(Table_SAEs_perc)

Table_SAEs_perc_plot <- ggplot(Table_SAEs_perc, aes(Percent_SAE, PERC, fill = Percent_SAE)) + geom_bar(stat = 'identity') + geom_text(aes(label = PERC)) + ylab("% VAERS SAE REPORTS") + theme(axis.text.y = element_text(colour = "#000000", size = 12)) + theme(axis.text.x = element_text(angle=0,vjust=0.5,hjust=0.5, size = 12)) + theme(legend.position = "none") + ggtitle("SAEs -> Comparison of Standard versus actual % reports")
Table_SAEs_perc_plot
```
```{r}
CARDIOVASCULAR_human <- function(SYMPTOM) {
  if(str_detect(SYMPTOM, paste(strings_cardiovascular, collapse = "|"))) {
   CV_human = "CARDIOVASCULAR"
    }
      else {
        CV_human = "NA"
    }
  return(CV_human)
}
NEUROLOGICAL_human <- function(SYMPTOM) {
  if(str_detect(SYMPTOM, paste(strings_neurological, collapse = "|"))) {
   NEURO_human = "NEUROLOGICAL"
    }
      else {
        NEURO_human = "NA"
    }
  return(NEURO_human)
}
IMMUNOLOGICAL_human <- function(SYMPTOM) {
  if(str_detect(SYMPTOM, paste(strings_immunological, collapse = "|"))) {
   IMMUNO_human = "IMMUNOLOGICAL"
    }
      else {
        IMMUNO_human = "NA"
    }
  return(IMMUNO_human)
}
```
```{r}
CV <- MERGED_SYM_DAT_VAX_06_04_21_191800kb %>% rowwise() %>% filter(SYMPTOM != "NA") %>% mutate("CARDIOVASCULAR" = CARDIOVASCULAR_human(SYMPTOM)) %>% filter(CARDIOVASCULAR !="NA")
NEURO <- MERGED_SYM_DAT_VAX_06_04_21_191800kb %>% rowwise() %>% filter(SYMPTOM != "NA") %>% mutate("NEUROLOGICAL" = NEUROLOGICAL_human(SYMPTOM)) %>% filter(NEUROLOGICAL !="NA")
IMMUNO <- MERGED_SYM_DAT_VAX_06_04_21_191800kb %>% rowwise() %>% filter(SYMPTOM != "NA") %>% mutate("IMMUNOLOGICAL" = IMMUNOLOGICAL_human(SYMPTOM)) %>% filter(IMMUNOLOGICAL !="NA")

#nrow(CV)
#nrow(NEURO)
#nrow(IMMUNO)
```
```{r}
strings_covid <- c("COVID-19", "Suspected COVID-19", "SARS-CoV-2 test positive", "COVID-19 pneumonia", "Asymptomatic COVID-19")
COVID_CASES <- function(SYMPTOM) {
  if(str_detect(SYMPTOM, paste(strings_covid, collapse = "|"))) {
      COVID19 = "COVID_CASE"
      } 
        else {
          COVID19 = "NA"
      }
    return(COVID19)
}
MERGED_SYM_DAT_VAX_06_04_21_191800kb_covid_cases <- MERGED_SYM_DAT_VAX_06_04_21_191800kb %>% rowwise() %>% filter(SYMPTOM != "NA") %>% mutate("COVID_CASES" = COVID_CASES(SYMPTOM)) %>% filter(COVID_CASES != "NA")
MERGED_SYM_DAT_VAX_06_04_21_191800kb_covid_cases <- replace(MERGED_SYM_DAT_VAX_06_04_21_191800kb_covid_cases, "SYMPTOM", "COVID19") 
#nrow(MERGED_SYM_DAT_VAX_06_04_21_191800kb_covid_cases)
MERGED_SYM_DAT_VAX_06_04_21_191800kb_covid_cases_dead <- MERGED_SYM_DAT_VAX_06_04_21_191800kb_covid_cases %>% filter(DIED == "Y") 
#nrow(MERGED_SYM_DAT_VAX_06_04_21_191800kb_covid_cases_dead)
Perc_D_BC = (nrow(MERGED_SYM_DAT_VAX_06_04_21_191800kb_covid_cases_dead)/nrow(MERGED_SYM_DAT_VAX_06_04_21_191800kb_covid_cases)*100)
#Perc_D_BC
```
```{r}
AGE_GROUPED_BY_DECADE <- function(AGE_YRS) {
  if(AGE_YRS >= 0 & AGE_YRS <10) {
    AGE_GROUP = "A. 0-10"
    } else if(AGE_YRS >= 10 & AGE_YRS <20) {
      AGE_GROUP = "B. 10-20"
      } else if(AGE_YRS >= 20 & AGE_YRS <30) {
        AGE_GROUP = "C. 20-30"
        } else if(AGE_YRS >= 30 & AGE_YRS <40) {
          AGE_GROUP = "D. 30-40"
          } else if(AGE_YRS >= 40 & AGE_YRS <50) {
            AGE_GROUP = "E. 40-50"
            } else if(AGE_YRS >= 50 & AGE_YRS <60) {
              AGE_GROUP = "F. 50-60"
              } else if(AGE_YRS >= 60 & AGE_YRS <70) {
                AGE_GROUP = "G. 60-70"
                } else if(AGE_YRS >= 70 & AGE_YRS <80) {
                  AGE_GROUP = "H. 70-80"
                  } else if(AGE_YRS >= 80 & AGE_YRS <90) {
                    AGE_GROUP = "I. 80-90"
                    } else if(AGE_YRS >= 90 & AGE_YRS <100) {
                      AGE_GROUP = "J. 90-100"
                      } else if(AGE_YRS >= 100 & AGE_YRS <110) {
                        AGE_GROUP = "K. 100-110"
                        }
  else {
    AGE_GROUP = "NA"
    }
  return(AGE_GROUP)
}
```
DISTRIBUTION OF ALL DATA BY AGE GROUP - THE MAJORITY OF INDIVIDUALS ARE BETWEEN THE AGES OF 30 AND 70
```{r}
#png("MERGED_SYM_DAT_VAX_06_04_21_191800kb_count_plot.png", width = 4, height = 4, units = 'in', res = 100)

MERGED_SYM_DAT_VAX_06_04_21_191800kb_AG <- MERGED_SYM_DAT_VAX_06_04_21_191800kb %>% rowwise() %>% filter(AGE_YRS != "NA") %>% mutate("AGE_GROUP" = AGE_GROUPED_BY_DECADE(AGE_YRS))
MERGED_SYM_DAT_VAX_06_04_21_191800kb_AG_count <- MERGED_SYM_DAT_VAX_06_04_21_191800kb_AG %>% count(AGE_GROUP)
MERGED_SYM_DAT_VAX_06_04_21_191800kb_count_plot <- ggplot(MERGED_SYM_DAT_VAX_06_04_21_191800kb_AG_count, aes(AGE_GROUP, n, fill = AGE_GROUP)) + geom_bar(stat = "Identity") + geom_text(aes(label = n)) + xlab("AGE GROUPS") + ylab("ADVERSE EVENTS (N)") + theme(axis.text.y = element_text(colour = "black", size = 12)) + theme(axis.text.x = element_text(colour = "black", angle=25,vjust=0.5,hjust=0.5, size = 8)) + theme(legend.position = "none") + ggtitle("ALL AEs -> Distribution of AGE GROUPS")
MERGED_SYM_DAT_VAX_06_04_21_191800kb_count_plot

MERGED_SYM_DAT_VAX_06_04_21_191800kb_AGE_count <- MERGED_SYM_DAT_VAX_06_04_21_191800kb %>% group_by(AGE_YRS) %>% filter(AGE_YRS != "NA") %>% count(AGE_YRS)
MERGED_SYM_DAT_VAX_06_04_21_191800kb_AGE_count <- data.frame(MERGED_SYM_DAT_VAX_06_04_21_191800kb_AGE_count, stringsAsFactors = FALSE) %>% mutate("skew" = 3*(mean(n)-median(n))/(sd(n)))
#MERGED_SYM_DAT_VAX_06_04_21_191800kb_AGE_count
```
NUMBER OF SPONTANEOUS ABORTIONS
```{r}
MERGED_SYM_DAT_VAX_06_04_21_191800kb_no_dups_SA <- MERGED_SYM_DAT_VAX_06_04_21_191800kb %>% group_by(SYMPTOM) %>% filter(SYMPTOM == "Abortion spontaneous")
nrow(MERGED_SYM_DAT_VAX_06_04_21_191800kb_no_dups_SA)
```
DISTRIBUTION OF SPONTANEOUS ABORTIONS - THIS SUBSET IS GROWING WEEKLY
```{r}
#png("MERGED_SYM_DAT_VAX_06_04_21_191800kb_SA_ID_plot", width = 4, height = 4, units = 'in', res = 100)

MERGED_SYM_DAT_VAX_06_04_21_191800kb_SA <- MERGED_SYM_DAT_VAX_06_04_21_191800kb %>% group_by(SYMPTOM) %>% filter(SYMPTOM == "Abortion spontaneous")
MERGED_SYM_DAT_VAX_06_04_21_191800kb_SA_ID <- MERGED_SYM_DAT_VAX_06_04_21_191800kb_SA %>% group_by(AGE_YRS) %>% filter(AGE_YRS != "NA") %>% count(AGE_YRS)
MERGED_SYM_DAT_VAX_06_04_21_191800kb_SA_ID_plot <- ggplot(MERGED_SYM_DAT_VAX_06_04_21_191800kb_SA_ID, aes(AGE_YRS, n, fill = AGE_YRS)) + geom_bar(stat = "Identity") + geom_text(aes(label = n)) + xlab("AGE YEARS") + ylab("NUMBER OF SPONTANEOUS ABORTIONS") + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 14))  + theme(legend.position = "none") + ggtitle("SPONTANEOUS ABORTION -> VAERS IDs vs AGE YEARS")
MERGED_SYM_DAT_VAX_06_04_21_191800kb_SA_ID_plot
```
```{r}
SA <- data.frame(MERGED_SYM_DAT_VAX_06_04_21_191800kb_SA, stringsAsFactors = FALSE) %>% filter(year(ONSET_DATE) <= 2021 & year(ONSET_DATE) >= 2020) 
MERGED_SYM_DAT_VAX_06_04_21_191800kb_SA_VD_OD <- SA %>% mutate("diff_in_days" = difftime(ONSET_DATE, VAX_DATE, units = "days")) %>% filter(diff_in_days >= 0 & diff_in_days <=50) %>% count(diff_in_days) %>% arrange(desc(n)) %>% mutate("OBSERVED" = n) %>% mutate("Percentage_OBSERVED" = n/sum(n)*100) %>% mutate("EXPECTED" = as.integer(mean(n))) %>% mutate("Percentage_EXPECTED" = EXPECTED/nrow(SA)*100)
#head(MERGED_SYM_DAT_VAX_06_04_21_191800kb_SA_VD_OD)

#chisq.test(MERGED_SYM_DAT_VAX_06_04_21_191800kb_SA_VD_OD$OBSERVED)
```
THE PLOTS SHOWING OBSERVED VERSUS EXPECTED TRAJECTORIES SHOW CLUSTERING OF DATA AROUND '0' - A LARGER PROPORTION OF REPORTS ARE MADE WITHIN 24 HOURS THAT ONE WOULD NOT EXPECT TO SEE IF THERE WAS NO CAUSALITY

Plot showing OBSERVED (orange) vs. EXPECTED (yellow) percentages of specific time-frames between Vaccination Date and Miscarriage Date
```{r}
#png("CAUSATION_SA_plot", width = 4, height = 4, units = 'in', res = 100)

CAUSATION_SA_plot <- ggplot() + geom_line(data = MERGED_SYM_DAT_VAX_06_04_21_191800kb_SA_VD_OD, aes(diff_in_days, Percentage_OBSERVED), colour = "orange", size = 2) + ylab("PERCENTAGE REPORTED SA AEs") + xlab("NUMBER OF DAYS FOLLOWING INJECTION") + geom_line(data = MERGED_SYM_DAT_VAX_06_04_21_191800kb_SA_VD_OD, aes(diff_in_days, Percentage_EXPECTED), colour = "yellow", size = 2) + labs(title = "SPONTANEOUS ABORTIONS post injection", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 12)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 12)) + theme(panel.background = element_rect(fill = "#100000")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) 
CAUSATION_SA_plot
```
HEATMAPS ARE BEAUTIFUL WAYS TO ILLUSTRATE A LOT OF INFORMATION IN A SINGLE FIGURE. THESE HEATMAPS SHOW THE INTERSECTIONS OF INJECTION DATES AND ONSET OF ADVERSE EVENT DATES AS PER SPECIFIC AE GROUP. THE COLOR OF THE INTERSECTION 'BLOCK' INDICATES THE NUMBER OF INTERSECTIONS THAT OCCURRED - RED = HIGHEST; BLUE = LOWEST. POINTS LYING ON THE DIAGONAL HAVE A CORRELATION COEFFICIENT WHERE R = 1, INDICATING A 1:1 CORRELATION. 

HEATMAP showing correlation between Vaccine Date and Onset Date for Spontaneous Abortions
```{r}
SA_VD_OD_TILE_count <- MERGED_SYM_DAT_VAX_06_04_21_191800kb_SA %>% group_by(ONSET_DATE, VAX_DATE) %>% filter(year(ONSET_DATE) <= 2021 & year(ONSET_DATE) >= 2021) %>% filter(year(VAX_DATE) <= 2021 & year(VAX_DATE) >= 2021) %>% mutate("diff_in_days" = difftime(ONSET_DATE, VAX_DATE, units = "days")) %>% filter(diff_in_days >= 0 & diff_in_days <=50) %>% count(diff_in_days)

#png("SA_VD_OD_TILE_count_plot ", width = 4, height = 4, units = 'in', res = 100)

SA_VD_OD_TILE_count_plot <- ggplot(SA_VD_OD_TILE_count, aes(VAX_DATE, ONSET_DATE)) + geom_tile(aes(fill = n)) + scale_fill_gradient('n', low = "blue", high = "red") + theme(panel.background = element_rect(fill = "black", color = 'black')) + ylab("ONSET OF SPONTANEOUS ABORTION") + xlab("VACCINE DATE") + theme(panel.grid=element_blank()) + theme(axis.text.x = element_text(colour = "black", size = 14)) + theme(axis.text.y = element_text(colour = "black", size = 14), axis.text.x=element_text(angle=0,vjust=0.5,hjust=0.5)) + ggtitle("VACCINE DATE vs SA DATE") 
SA_VD_OD_TILE_count_plot
```
Distribution of all Breakthrough COVID-19 cases by age group
```{r}
#png("AGE_GROUPS_COVID_plot", width = 4, height = 4, units = 'in', res = 100)
AGE_GROUPS_COVID <- MERGED_SYM_DAT_VAX_06_04_21_191800kb_covid_cases %>% rowwise() %>% filter(AGE_YRS != "NA") %>% mutate("AGE_GROUP" = AGE_GROUPED_BY_DECADE(AGE_YRS))
AGE_GROUPS_COVID_count <- AGE_GROUPS_COVID %>% group_by(AGE_GROUP) %>% filter(AGE_GROUP != "NA") %>% count(AGE_GROUP)
AGE_GROUPS_COVID_plot <- ggplot(AGE_GROUPS_COVID_count, aes(AGE_GROUP, n, fill = AGE_GROUP)) + geom_bar(stat = "Identity") + geom_text(aes(label = n)) + xlab("AGE GROUPS") + ylab("NUMBER OF COVID-19 BREAKTHROUGH INFECTIONS") + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=25,vjust=0.5,hjust=0.5, size = 8)) + theme(legend.position = "none") + ggtitle("Breakthough Covid-19 Infections -> VAERS IDs vs AGE GROUPS")
AGE_GROUPS_COVID_plot

AGE_GROUPS_COVID_plot_skew <- data.frame(AGE_GROUPS_COVID_count, stringsAsFactors = FALSE) %>% mutate("skew" = 3*(mean(n)-median(n))/(sd(n)))
#AGE_GROUPS_COVID_plot_skew
```
CUMULATIVE BREAKTHROUGH COVID-19 CASES
```{r}
Table_IDs_COVID_percent <- data.frame(
  DATE = as.Date(c("1/16/21", "1/23/21", "1/30/21", "2/13/21", "2/27/21", "3/5/21", "3/12/21", "3/19/21", "3/26/21", "4/2/21", "4/9/21", "4/16/21", "4/23/21", "4/30/21", "5/7/21", "5/12/21", "5/19/21", "5/28/21", "6/4/21"), "%m/%d/%y"),
  COVID = as.numeric(c("194", "254", "326", "619", "717", "776", "943", "1057", "1169", "1267", "1375", "1404", "1587", "1930", "2776", "3317", "3742", "4285", "4850")),
  
  stringsAsFactors = FALSE
)
#head(Table_IDs_COVID_percent)

#png("Table_IDs_COVID_plot.png", width = 4, height = 4, units = 'in', res = 100)

Table_IDs_COVID_plot <- ggplot(data = Table_IDs_COVID_percent, aes(x = DATE, y = COVID)) + geom_line(data = Table_IDs_COVID_percent, aes(x = DATE, y = COVID, colour = "COVID"), colour = "red", size = 2) + geom_point(data = Table_IDs_COVID_percent, aes(DATE, COVID, colour = "COVID"), colour = "red", size = 5) + xlab("DATE") +  ylab("NUMBER OF BREAKTHROUGH INFECTIONS") + labs(title = "ABSOLUTE NUMBER OF BREAKTHROUGH INFECTIONS (CUMULATIVE)", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=15,vjust=0.5,hjust=0.5, size = 10)) + theme(panel.background = element_rect(fill = "black")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + theme(legend.title=element_blank()) + scale_x_continuous(breaks = round(seq(min(Table_IDs_COVID_percent$DATE), max(Table_IDs_COVID_percent$DATE), by = 10),0.1))
Table_IDs_COVID_plot
```
```{r}
BCC_count <- MERGED_SYM_DAT_VAX_06_04_21_191800kb_covid_cases %>% group_by(SYMPTOM, VAX_MANU) %>% count(SYMPTOM)
BCC_count_plot <- ggplot(BCC_count, aes(VAX_MANU, n, fill = VAX_MANU)) + geom_bar(stat = "Identity") + geom_text(aes(label = n)) + xlab("ID COUNT (N)") + ylab("COVID DIAGNOSIS") + theme(axis.text.y = element_text(colour = "#000000", size = 12)) + theme(axis.text.x = element_text(angle=0,vjust=0.5,hjust=0.5, size = 10)) + ggtitle("COVID CASES AS PER MANUFACTURER") + theme(legend.position = "none")
```
BREAKTHROUGH COVID CASES BY MANUFACTURER
```{r}
no_COVID_sym <- MERGED_SYM_DAT_VAX_06_04_21_191800kb %>% filter(SYMPTOM != "COVID19")
no_BCC_count_VM <- no_COVID_sym %>% group_by(VAX_MANU) %>% count(VAX_MANU) %>% filter(VAX_MANU != "NA" & VAX_MANU != "UNKNOWN MANUFACTURER") %>% mutate("PERC" = n/(nrow(MERGED_SYM_DAT_VAX_06_04_21_191800kb))*100) %>% mutate("Round" = round(PERC, 2))
#no_BCC_count_VM
BCC_count_VM <- MERGED_SYM_DAT_VAX_06_04_21_191800kb_covid_cases %>% group_by(VAX_MANU) %>% count(VAX_MANU) %>% filter(VAX_MANU != "NA" & VAX_MANU != "UNKNOWN MANUFACTURER") %>% mutate("PERC" = n/(nrow(MERGED_SYM_DAT_VAX_06_04_21_191800kb_covid_cases))*100) %>% mutate("Round" = round(PERC, 2))
BCC_count_VM <- data.frame(BCC_count_VM, stringsAsFactors = FALSE) 
#BCC_count_VM
```
```{r}
pie_VM <- plot_ly(BCC_count_VM, labels = ~VAX_MANU, values = ~Round, type = 'pie')
pie_VM <- pie_VM %>% layout(title = 'BREAKTHROUGH COVID-19 CASES BY MANUFACTURER',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))
pie_VM
```
THE QUESTION OF DISTRIBUTION BY MANUFACTURER SHOULD BE ANSWERED IN ORDER TO ASSESS WHETHER OR NOT PFIZER IS ACTUALLY MORE HIGHLY ASSOCIATED WITH BREAKTHROUGH INFECTIONS - THE PRODUCTS ARE EQUALLY DISTRIBUTED THROUGHOUT THE U.S. POPULATION SO IT APPEARS AS THOUGH PFIZER IS MORE HIGHLY ASSOCIATED WITH BREAKTHROUGH INFECTIONS

Pie chart for distribution of vax manu data in US population (U.S. COVID-19 Vaccine Delivered by Vaccine Type					
Date generated: CDC | Data as of: May 4, 2021 6:00am ET. Posted: Tuesday, May 25, 2021 6:00 PM ET https://covid.cdc.gov/covid-data-tracker/#vaccinations 
```{r}
Table_DIST_VM_US <- data.frame(
  VAX_MANU = c("PFIZER/BIONTECH", "MODERNA", "JANSSEN"),
  FVP = as.integer(c(67434538, 52916100, 10210450)),
 
  stringsAsFactors = FALSE
)
Table_DIST_VM_US_percent <- data.frame(Table_DIST_VM_US, stringsAsFactors = FALSE) %>% mutate("TOTAL_PMJ" = as.numeric(round(sum(FVP)))) %>% mutate("Percentage_PMJ" = as.numeric(FVP/(TOTAL_PMJ)*100)) %>% mutate("Round" = round(Percentage_PMJ, 2))
#Table_DIST_VM_US_percent
```
```{r}
pie_Table_DIST_VM_US_percent <- plot_ly(Table_DIST_VM_US_percent, labels = ~VAX_MANU, values = ~Round, type = 'pie')
pie_Table_DIST_VM_US_percent <- pie_Table_DIST_VM_US_percent %>% layout(title = 'FULLY-VAXXED U.S. POPULATION BY MANUFACTURER',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))
pie_Table_DIST_VM_US_percent 
```
BREAKTHROUGH COVID-19 CASES WHO DIED
```{r}
BCC_count_VM_dead <- MERGED_SYM_DAT_VAX_06_04_21_191800kb_covid_cases %>% group_by(VAX_MANU, DIED) %>% count(DIED) %>% filter(VAX_MANU != "NA" & VAX_MANU != "UNKNOWN MANUFACTURER" & DIED == "Y") %>% mutate("PERC" = n/(nrow(MERGED_SYM_DAT_VAX_06_04_21_191800kb_covid_cases))*100) %>% mutate("Round" = round(PERC, 2))
BCC_count_VM_dead <- data.frame(BCC_count_VM_dead, stringsAsFactors = FALSE) 
#BCC_count_VM_dead
```
```{r}
pie_VM_dead <- plot_ly(BCC_count_VM_dead, labels = ~VAX_MANU, values = ~Round, type = 'pie')
pie_VM_dead <- pie_VM_dead %>% layout(title = 'BREAKTHROUGH COVID-19 CASES resulting in death BY MANUFACTURER',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))
pie_VM_dead
```
BUT THANKFULLY, DEATH IS NOT EVENLY DISTRIBUTED BETWEEN MANUFACTURERS
```{r}
AGE_GROUPS_COVID <- MERGED_SYM_DAT_VAX_06_04_21_191800kb_covid_cases %>% rowwise() %>% filter(AGE_YRS != "NA") %>% mutate("AGE_GROUP" = AGE_GROUPED_BY_DECADE(AGE_YRS))
AGE_GROUPS_COVID_dead <- data.frame(AGE_GROUPS_COVID, stringsAsFactors = FALSE) %>% group_by(AGE_GROUP, DIED) %>% filter(DIED == "Y") %>% count(DIED) %>% mutate("SUM" = as.numeric(sum(n))) %>% mutate("Perc_D_tot" = as.numeric(n/(nrow(AGE_GROUPS_COVID))*100)) %>% mutate("Round" = round(Perc_D_tot, 2))
#AGE_GROUPS_COVID_dead
```
BREAKTHROUGH COVID-19 CASES WHO DIED BY AGE
```{r}
pie_AGE_GROUPS_COVID_dead <- plot_ly(AGE_GROUPS_COVID_dead, labels = ~AGE_GROUP, values = ~Round, type = 'pie')
pie_AGE_GROUPS_COVID_dead <- pie_AGE_GROUPS_COVID_dead %>% layout(title = 'BREAKTHROUGH COVID-19 CASES RESULTING IN DEATH BY AGE GROUP',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))
pie_AGE_GROUPS_COVID_dead
```
```{r}
D <- MERGED_SYM_DAT_VAX_06_04_21_191800kb %>% filter(DIED == "Y") %>% filter(year(DATEDIED) <= 2021 & year(DATEDIED) >= 2020) 
MERGED_SYM_DAT_VAX_06_04_21_191800kb_VD_DD <- D %>% mutate("diff_in_days" = difftime(DATEDIED, VAX_DATE, units = "days")) %>% filter(diff_in_days >= 0 & diff_in_days <=50) %>% count(diff_in_days) %>% arrange(desc(n)) %>% mutate("OBSERVED" = n) %>% mutate("Percentage_OBSERVED" = n/sum(n)*100) %>% mutate("EXPECTED" = as.integer(mean(n))) %>% mutate("Percentage_EXPECTED" = EXPECTED/nrow(D)*100)
#head(MERGED_SYM_DAT_VAX_06_04_21_191800kb_VD_DD)

#chisq.test(MERGED_SYM_DAT_VAX_06_04_21_191800kb_VD_DD$OBSERVED)
```
Plot showing OBSERVED (orange) vs. EXPECTED (yellow) percentages of specific time-frames between Vaccination Date and Death Date
```{r}
CAUSATION_DEATH_plot <- ggplot() + geom_line(data = MERGED_SYM_DAT_VAX_06_04_21_191800kb_VD_DD, aes(diff_in_days, Percentage_OBSERVED), colour = "orange", size = 2) + ylab("PERCENTAGE OF REPORTED DEATHS") + xlab("NUMBER OF DAYS FOLLOWING INJECTION") + geom_line(data = MERGED_SYM_DAT_VAX_06_04_21_191800kb_VD_DD, aes(diff_in_days, Percentage_EXPECTED), colour = "yellow", size = 2) + labs(title = "DEATHS post injection", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 12)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 12)) + theme(panel.background = element_rect(fill = "#100000", color = "pink")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
CAUSATION_DEATH_plot
CAUSATION_DEATH_plot_closeup <- ggplot() + geom_line(data = MERGED_SYM_DAT_VAX_06_04_21_191800kb_VD_DD, aes(diff_in_days, Percentage_OBSERVED), colour = "orange", size = 2) + ylab("PERCENTAGE OF REPORTED DEATHS") + xlab("NUMBER OF DAYS FOLLOWING INJECTION") + geom_line(data = MERGED_SYM_DAT_VAX_06_04_21_191800kb_VD_DD, aes(diff_in_days, Percentage_EXPECTED), colour = "yellow", size = 2) + labs(title = "DEATHS post injection", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 12)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 12)) + theme(panel.background = element_rect(fill = "#100000", color = "pink")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + ylim(0,6)
CAUSATION_DEATH_plot_closeup

D_2021 <- MERGED_SYM_DAT_VAX_06_04_21_191800kb %>% group_by(VAERS_ID, DIED) %>% filter(DIED == "Y")
DEAD_2021 <- subset(D_2021, !duplicated(subset(D_2021, select=c(VAERS_ID))))
#nrow(DEAD_2021)
DEAD_2021 <- DEAD_2021 %>% filter(year(DATEDIED) <= 2021 & year(DATEDIED) >= "2021") 

DEAD_2021_count <- DEAD_2021 %>% group_by(DATEDIED, DIED) %>% count(DIED) %>% arrange(desc(DATEDIED)) %>% mutate("US_tot_death_p_mill_day" = 8697/332738974*1000000) %>% mutate("DIED_FV_p_mill_UR_33" = n/126610000*1000000*33) %>% mutate("DIED_FV_p_mill_UR_100" = n/126610000*1000000*100) %>% mutate("DIED_FV_p_mill_UR_200" = n/126610000*1000000*1000)
#DEAD_2021_count

DEATHS_2021_plot_p_day <- ggplot(data = DEAD_2021_count, aes(x = DATEDIED, y = DIED_FV_p_mill_UR)) + geom_point(data = DEAD_2021_count, aes(DATEDIED, DIED_FV_p_mill_UR_33), colour = "red", size = 5) + geom_point(data = DEAD_2021_count, aes(DATEDIED, DIED_FV_p_mill_UR_200), colour = "blue", size = 5) + geom_point(data = DEAD_2021_count, aes(DATEDIED, DIED_FV_p_mill_UR_100), colour = "purple", size = 5) + geom_line(data = DEAD_2021_count, aes(DATEDIED, US_tot_death_p_mill_day), colour = "yellow", size = 2) + ylab("Number of deaths per million people") + labs(title = "DEATHS FOR 2021", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "#000000", size = 12)) + theme(axis.text.x = element_text(angle=0,vjust=0.5,hjust=0.5, size = 12)) + theme(panel.background = element_rect(fill = "#100000")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
DEATHS_2021_plot_p_day
```
HEATMAP showing correlation between Vaccine Date and Onset Date for Deaths
```{r}
VD_DD_TILE_count <- MERGED_SYM_DAT_VAX_06_04_21_191800kb %>% group_by(DIED, DATEDIED, VAX_DATE) %>% filter(DIED == "Y") %>% filter(year(DATEDIED) <= 2021 & year(DATEDIED) >= 2021) %>% filter(year(VAX_DATE) <= 2021 & year(VAX_DATE) >= 2021)%>% mutate("diff_in_days" = difftime(DATEDIED, VAX_DATE, units = "days")) %>% filter(diff_in_days >= 0 & diff_in_days <=50) %>% count(diff_in_days) 

VD_DD_TILE_plot <- ggplot(VD_DD_TILE_count, aes(VAX_DATE, DATEDIED)) + geom_tile(aes(fill = n)) + scale_fill_gradient('n', low = "blue", high = "red") + theme(panel.background = element_rect(fill = "black", color = 'black')) + ylab("DATE OF DEATH") + xlab("VACCINE DATE") + theme(panel.grid=element_blank()) + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 14)) + ggtitle("VACCINE DATE vs DEATH DATE OF AEs") 
VD_DD_TILE_plot
```
Plot showing OBSERVED (orange) vs. EXPECTED (yellow) percentages of specific time-frames between Vaccination Date and Onset Date of Cardiovascular Adverse Event
```{r}
CV_new <- data.frame(CV, stringsAsFactors = FALSE) %>% filter(year(ONSET_DATE) <= 2021 & year(ONSET_DATE) >= 2020) 
MERGED_SYM_DAT_VAX_06_04_21_191800kb_CV_VD_OD <- CV_new %>% mutate("diff_in_days" = difftime(ONSET_DATE, VAX_DATE, units = "days")) %>% filter(diff_in_days >= 0 & diff_in_days <=50) %>% count(diff_in_days) %>% arrange(desc(n))  %>% mutate("OBSERVED" = n) %>% mutate("Percentage_OBSERVED" = n/sum(n)*100) %>% mutate("EXPECTED" = mean(n)) %>% mutate("EXPECTED" = mean(n)) %>% mutate("Percentage_EXPECTED" = EXPECTED/nrow(CV_new)*100)
#head(MERGED_SYM_DAT_VAX_06_04_21_191800kb_CV_VD_OD)

#chisq.test(MERGED_SYM_DAT_VAX_06_04_21_191800kb_CV_VD_OD$OBSERVED)
```
```{r}
CAUSATION_CV_plot <- ggplot() + geom_line(data = MERGED_SYM_DAT_VAX_06_04_21_191800kb_CV_VD_OD, aes(diff_in_days, Percentage_OBSERVED), colour = "orange", size = 2) + xlab("NUMBER OF DAYS FOLLOWING INJECTION") +  ylab("PERCENTAGE OF REPORTED CV AEs") + geom_line(data = MERGED_SYM_DAT_VAX_06_04_21_191800kb_CV_VD_OD, aes(diff_in_days, Percentage_EXPECTED), colour = "yellow", size = 2) + labs(title = "CARDIOVASCULAR AEs post injection", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 14)) + theme(panel.background = element_rect(fill = "#100000", color = "pink")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + ylim(0,60)
CAUSATION_CV_plot
CAUSATION_CV_plot_closeup <- ggplot() + geom_line(data = MERGED_SYM_DAT_VAX_06_04_21_191800kb_CV_VD_OD, aes(diff_in_days, Percentage_OBSERVED), colour = "orange", size = 2) + xlab("NUMBER OF DAYS FOLLOWING INJECTION") +  ylab("PERCENTAGE OF REPORTED CV AEs") + geom_line(data = MERGED_SYM_DAT_VAX_06_04_21_191800kb_CV_VD_OD, aes(diff_in_days, Percentage_EXPECTED), colour = "yellow", size = 2) + labs(title = "CARDIOVASCULAR AEs post injection", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 14)) + theme(panel.background = element_rect(fill = "#100000", color = "pink")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + ylim(0,4)
CAUSATION_CV_plot_closeup
```
HEATMAP showing correlation between Vaccine Date and Onset Date for Cardiovascular Adverse Events
```{r}
CV_VD_DD_TILE_count <- CV_new %>% group_by(CARDIOVASCULAR, ONSET_DATE, VAX_DATE) %>% filter(year(ONSET_DATE) <= 2021 & year(ONSET_DATE) >= 2021) %>% filter(year(VAX_DATE) <= 2021 & year(VAX_DATE) >= 2021) %>% mutate("diff_in_days" = difftime(ONSET_DATE, VAX_DATE, units = "days")) %>% filter(diff_in_days >= 0 & diff_in_days <=50) %>% count(diff_in_days) 

CV_VD_DD_TILE_plot <- ggplot(CV_VD_DD_TILE_count, aes(VAX_DATE, ONSET_DATE)) + geom_tile(aes(fill = n)) + scale_fill_gradient('n', low = "blue", high = "red") + theme(panel.background = element_rect(fill = "black", color = 'black')) + ylab("DATE OF CV") + xlab("VACCINE DATE") + theme(panel.grid=element_blank()) + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 14)) + ggtitle("VACCINE DATE vs CV DATE OF AEs") 
CV_VD_DD_TILE_plot
```
Plot showing OBSERVED (orange) vs. EXPECTED (yellow) percentages of specific time-frames between Vaccination Date and Onset Date of Neurological Adverse Event
```{r}
NEURO_new <- data.frame(NEURO, stringsAsFactors = FALSE) %>% filter(year(ONSET_DATE) <= 2021 & year(ONSET_DATE) >= 2020) 
MERGED_SYM_DAT_VAX_06_04_21_191800kb_NEURO_VD_OD <- NEURO_new %>% mutate("diff_in_days" = difftime(ONSET_DATE, VAX_DATE, units = "days")) %>% filter(diff_in_days >= 0 & diff_in_days <=50) %>% count(diff_in_days) %>% arrange(desc(n))  %>% mutate("OBSERVED" = n) %>% mutate("Percentage_OBSERVED" = n/nrow(NEURO_new)*100) %>% mutate("EXPECTED" = mean(n)) %>% mutate("EXPECTED" = mean(n)) %>% mutate("Percentage_EXPECTED" = EXPECTED/nrow(NEURO_new)*100)
#head(MERGED_SYM_DAT_VAX_06_04_21_191800kb_NEURO_VD_OD)

#chisq.test(MERGED_SYM_DAT_VAX_06_04_21_191800kb_NEURO_VD_OD$OBSERVED)
```
```{r}
CAUSATION_NEURO_plot <- ggplot() + geom_line(data = MERGED_SYM_DAT_VAX_06_04_21_191800kb_NEURO_VD_OD, aes(diff_in_days, Percentage_OBSERVED), colour = "orange", size = 2) + xlab("NUMBER OF DAYS FOLLOWING INJECTION") +  ylab("PERCENTAGE OF REPORTED NEURO AEs") + geom_line(data = MERGED_SYM_DAT_VAX_06_04_21_191800kb_NEURO_VD_OD, aes(diff_in_days, Percentage_EXPECTED), colour = "yellow", size = 2) + labs(title = "NEUROLOGICAL AEs post injection", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 14)) + theme(panel.background = element_rect(fill = "#100000", color = "pink")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
CAUSATION_NEURO_plot
CAUSATION_NEURO_plot_closeup <- ggplot() + geom_line(data = MERGED_SYM_DAT_VAX_06_04_21_191800kb_NEURO_VD_OD, aes(diff_in_days, Percentage_OBSERVED), colour = "orange", size = 2) + xlab("NUMBER OF DAYS FOLLOWING INJECTION") +  ylab("PERCENTAGE OF REPORTED NEURO AEs") + geom_line(data = MERGED_SYM_DAT_VAX_06_04_21_191800kb_NEURO_VD_OD, aes(diff_in_days, Percentage_EXPECTED), colour = "yellow", size = 2) + labs(title = "NEUROLOGICAL AEs post injection", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 14)) + theme(panel.background = element_rect(fill = "#100000", color = "pink")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + ylim(0,4)
CAUSATION_NEURO_plot_closeup
```
HEATMAP showing correlation between Vaccine Date and Onset Date for Neurological Adverse Events
```{r}
NEURO_VD_OD_TILE_count <- NEURO_new %>% group_by(NEUROLOGICAL, ONSET_DATE, VAX_DATE) %>% filter(year(ONSET_DATE) <= 2021 & year(ONSET_DATE) >= 2021) %>% filter(year(VAX_DATE) <= 2021 & year(VAX_DATE) >= 2021)%>% mutate("diff_in_days" = difftime(ONSET_DATE, VAX_DATE, units = "days")) %>% filter(diff_in_days >= 0 & diff_in_days <=50) %>% count(diff_in_days) 

#png("NEURO_VD_DD_TILE_plot ", width = 4, height = 4, units = 'in', res = 100)

NEURO_VD_DD_TILE_plot <- ggplot(NEURO_VD_OD_TILE_count, aes(VAX_DATE, ONSET_DATE)) + geom_tile(aes(fill = n)) + scale_fill_gradient('n', low = "blue", high = "red") + theme(panel.background = element_rect(fill = "black", color = 'black')) + ylab("ONSET OF AEs") + xlab("VACCINE DATE") + theme(panel.grid=element_blank()) + theme(axis.text.x = element_text(colour = "#000000", size = 14)) + theme(axis.text.y = element_text(colour = "#000000", size = 14), axis.text.x=element_text(angle=0,vjust=0.5,hjust=0.5)) + ggtitle("VACCINE DATE vs NEUROLOGICAL AE ONSET DATE") 
NEURO_VD_DD_TILE_plot
```
Plot showing OBSERVED (orange) vs. EXPECTED (yellow) percentages of specific time-frames between Vaccination Date and Onset Date of Immunological Adverse Event
```{r}
IMMUNO_new <- data.frame(IMMUNO, stringsAsFactors = FALSE) %>% filter(year(ONSET_DATE) <= 2021 & year(ONSET_DATE) >= 2020) 
MERGED_SYM_DAT_VAX_06_04_21_191800kb_IMMUNO_VD_OD <- IMMUNO_new %>% mutate("diff_in_days" = difftime(ONSET_DATE, VAX_DATE, units = "days")) %>% filter(diff_in_days >= 0 & diff_in_days <=50) %>% count(diff_in_days) %>% arrange(desc(n))  %>% mutate("OBSERVED" = n) %>% mutate("Percentage_OBSERVED" = n/nrow(IMMUNO_new)*100) %>% mutate("EXPECTED" = mean(n)) %>% mutate("EXPECTED" = mean(n)) %>% mutate("Percentage_EXPECTED" = EXPECTED/nrow(IMMUNO_new)*100)
#head(MERGED_SYM_DAT_VAX_06_04_21_191800kb_IMMUNO_VD_OD)

#chisq.test(MERGED_SYM_DAT_VAX_06_04_21_191800kb_IMMUNO_VD_OD$OBSERVED)
```
```{r}
CAUSATION_IMMUNO_plot <- ggplot() + geom_line(data = MERGED_SYM_DAT_VAX_06_04_21_191800kb_IMMUNO_VD_OD, aes(diff_in_days, Percentage_OBSERVED), colour = "orange", size = 2) + xlab("NUMBER OF DAYS FOLLOWING INJECTION") +  ylab("PERCENTAGE OF REPORTED IMMUNO AEs") + geom_line(data = MERGED_SYM_DAT_VAX_06_04_21_191800kb_IMMUNO_VD_OD, aes(diff_in_days, Percentage_EXPECTED), colour = "yellow", size = 2) + labs(title = "IMMUNOLOGICAL AEs post injection", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 14)) + theme(panel.background = element_rect(fill = "#100000", color = "pink")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
CAUSATION_IMMUNO_plot
CAUSATION_IMMUNO_plot_closeup <- ggplot() + geom_line(data = MERGED_SYM_DAT_VAX_06_04_21_191800kb_IMMUNO_VD_OD, aes(diff_in_days, Percentage_OBSERVED), colour = "orange", size = 2) + xlab("NUMBER OF DAYS FOLLOWING INJECTION") +  ylab("PERCENTAGE OF REPORTED IMMUNO AEs") + geom_line(data = MERGED_SYM_DAT_VAX_06_04_21_191800kb_IMMUNO_VD_OD, aes(diff_in_days, Percentage_EXPECTED), colour = "yellow", size = 2) + labs(title = "IMMUNOLOGICAL AEs post injection", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 14)) + theme(panel.background = element_rect(fill = "#100000", color = "pink")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + ylim(0,7)

CAUSATION_IMMUNO_plot_closeup

I_2021 <- subset(IMMUNO, !duplicated(subset(IMMUNO, select=c(VAERS_ID))))
#nrow(I_2021)
I_2021 <- I_2021 %>% filter(year(ONSET_DATE) <= 2021 & year(ONSET_DATE) >= "2021") 

I_2021_count <- I_2021 %>% group_by(ONSET_DATE, SYMPTOM) %>% count(SYMPTOM) %>% arrange(desc(ONSET_DATE)) %>% mutate("immuno_FV_p_mill" = n/126610000*1000000) %>% mutate("US_tot_immuno_p_mill_day" = 8697/332738974*1000000) %>% mutate("immuno_FV_p_mill_UR_33" = n/126610000*1000000*33) %>% mutate("immuno_FV_p_mill_UR_100" = n/126610000*1000000*100) %>% mutate("immuno_FV_p_mill_UR_200" = n/126610000*1000000*1000)
#DEAD_2021_count

I_2021_plot_FV_p__mill_day <- ggplot(data = I_2021_count, aes(x = ONSET_DATE, y = immuno_FV_p_mill)) + geom_point(data = I_2021_count, aes(ONSET_DATE, immuno_FV_p_mill), colour = "red", size = 1) + ylab("Number of IAEs per million people") + labs(title = "DEATHS FOR 2021", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "#000000", size = 12)) + theme(axis.text.x = element_text(angle=0,vjust=0.5,hjust=0.5, size = 12)) + theme(panel.background = element_rect(fill = "#100000")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
#I_2021_plot_FV_p__mill_day
```
HEATMAP showing correlation between Vaccine Date and Onset Date for Immunological Adverse Events
```{r}
IMMUNO_VD_OD_TILE_count <- IMMUNO_new %>% group_by(IMMUNOLOGICAL, ONSET_DATE, VAX_DATE) %>% filter(year(ONSET_DATE) <= 2021 & year(ONSET_DATE) >= 2021) %>% filter(year(VAX_DATE) <= 2021 & year(VAX_DATE) >= 2021)%>% mutate("diff_in_days" = difftime(ONSET_DATE, VAX_DATE, units = "days")) %>% filter(diff_in_days >= 0 & diff_in_days <=50) %>% count(diff_in_days) 

#png("IMMUNO_VD_DD_TILE_plot", width = 4, height = 4, units = 'in', res = 100)

IMMUNO_VD_DD_TILE_plot <- ggplot(IMMUNO_VD_OD_TILE_count, aes(VAX_DATE, ONSET_DATE)) + geom_tile(aes(fill = n)) + scale_fill_gradient('n', low = "blue", high = "red") + theme(panel.background = element_rect(fill = "black", color = 'black')) + ylab("ONSET OF AEs") + xlab("VACCINE DATE") + theme(panel.grid=element_blank()) + theme(axis.text.x = element_text(colour = "#000000", size = 14)) + theme(axis.text.y = element_text(colour = "#000000", size = 14), axis.text.x=element_text(angle=0,vjust=0.5,hjust=0.5)) + ggtitle("VACCINE DATE vs IMMUNOLOGICAL AE ONSET DATE") 
IMMUNO_VD_DD_TILE_plot
```
```{r}
AGE_GROUPS_D <- D %>% rowwise() %>% filter(AGE_YRS != "NA") %>% mutate("AGE_GROUP" = AGE_GROUPED_BY_DECADE(AGE_YRS))
AGE_GROUPS_CV_new <- CV_new %>% rowwise() %>% filter(AGE_YRS != "NA") %>% mutate("AGE_GROUP" = AGE_GROUPED_BY_DECADE(AGE_YRS))
AGE_GROUPS_NEURO_new <- NEURO_new %>% rowwise() %>% filter(AGE_YRS != "NA") %>% mutate("AGE_GROUP" = AGE_GROUPED_BY_DECADE(AGE_YRS))
AGE_GROUPS_IMMUNO_new <- IMMUNO_new %>% rowwise() %>% filter(AGE_YRS != "NA") %>% mutate("AGE_GROUP" = AGE_GROUPED_BY_DECADE(AGE_YRS))
```
Histograms to show distributions by age group in Death, Hospital, ER, CV, Neuro and Immuno AE groups
```{r}
#png("AGE_GROUPS_D_ALL_ID_plot", width = 4, height = 4, units = 'in', res = 100)

AGE_GROUPS_D_ALL_ID <- AGE_GROUPS_D %>% group_by(AGE_GROUP) %>% filter(AGE_GROUP != "NA") %>% count(AGE_GROUP)
AGE_GROUPS_D_ALL_ID_plot <- ggplot(AGE_GROUPS_D_ALL_ID, aes(AGE_GROUP, n, fill = AGE_GROUP)) + geom_bar(stat = "Identity") + geom_text(aes(label = n)) + xlab("AGE GROUPS") + ylab("NUMBER OF DEATHS") + theme(axis.text.y = element_text(colour = "black", size = 12)) + theme(axis.text.x = element_text(colour = "black", angle=25,vjust=0.5,hjust=0.5, size = 8)) + theme(legend.position = "none") + ggtitle("Death -> VAERS IDs vs AGE GROUPS")
AGE_GROUPS_D_ALL_ID_plot
AGE_GROUPS_D_ALL_ID_skew <- data.frame(AGE_GROUPS_D_ALL_ID, stringsAsFactors = FALSE) %>% mutate("skew" = 3*(mean(n)-median(n))/(sd(n)))
#AGE_GROUPS_D_ALL_ID_skew
```
```{r}
#png("AGE_GROUPS_CV_ALL_ID_plot", width = 4, height = 4, units = 'in', res = 100)

AGE_GROUPS_CV_ALL_ID <- AGE_GROUPS_CV_new %>% group_by(AGE_GROUP) %>% filter(AGE_GROUP != "NA") %>% count(AGE_GROUP)
AGE_GROUPS_CV_ALL_ID_plot <- ggplot(AGE_GROUPS_CV_ALL_ID, aes(AGE_GROUP, n, fill = AGE_GROUP)) + geom_bar(stat = "Identity") + geom_text(aes(label = n)) + xlab("AGE GROUPS") + ylab("NUMBER OF CARDIOVASCULAR AEs") + theme(axis.text.y = element_text(colour = "black", size = 12)) + theme(axis.text.x = element_text(colour = "black", angle=25,vjust=0.5,hjust=0.5, size = 8)) + theme(legend.position = "none") + ggtitle("Cardiovascular Events -> VAERS IDs vs AGE GROUPS")
AGE_GROUPS_CV_ALL_ID_plot
AGE_GROUPS_CV_ALL_ID_skew <- data.frame(AGE_GROUPS_CV_ALL_ID, stringsAsFactors = FALSE) %>% mutate("skew" = 3*(mean(n)-median(n))/(sd(n)))
#AGE_GROUPS_CV_ALL_ID_skew
```
```{r}
#png("AGE_GROUPS_NEURO_ALL_ID_plot", width = 4, height = 4, units = 'in', res = 100)

AGE_GROUPS_NEURO_ALL_ID <- AGE_GROUPS_NEURO_new %>% group_by(AGE_GROUP) %>% filter(AGE_GROUP != "NA") %>% count(AGE_GROUP)
AGE_GROUPS_NEURO_ALL_ID_plot <- ggplot(AGE_GROUPS_NEURO_ALL_ID, aes(AGE_GROUP, n, fill = AGE_GROUP)) + geom_bar(stat = "Identity") + geom_text(aes(label = n)) + xlab("AGE GROUPS") + ylab("NUMBER OF NEUROLOGICAL AEs") + theme(axis.text.y = element_text(colour = "black", size = 12)) + theme(axis.text.x = element_text(colour = "black", angle=25,vjust=0.5,hjust=0.5, size = 8)) + theme(legend.position = "none") + ggtitle("Neurological Events -> VAERS IDs vs AGE GROUPS")
AGE_GROUPS_NEURO_ALL_ID_plot
AGE_GROUPS_NEURO_ALL_ID_skew <- data.frame(AGE_GROUPS_NEURO_ALL_ID, stringsAsFactors = FALSE) %>% mutate("skew" = 3*(mean(n)-median(n))/(sd(n)))
#AGE_GROUPS_NEURO_ALL_ID_skew
```
```{r}
#png("AGE_GROUPS_IMMUNO_ALL_ID_plot", width = 4, height = 4, units = 'in', res = 100)

AGE_GROUPS_IMMUNO_ALL_ID <- AGE_GROUPS_IMMUNO_new %>% group_by(AGE_GROUP) %>% filter(AGE_GROUP != "NA") %>% count(AGE_GROUP)
AGE_GROUPS_IMMUNO_ALL_ID_plot <- ggplot(AGE_GROUPS_IMMUNO_ALL_ID, aes(AGE_GROUP, n, fill = AGE_GROUP)) + geom_bar(stat = "Identity") + geom_text(aes(label = n)) + xlab("AGE GROUPS") + ylab("NUMBER OF IMMUNOLOGICAL AEs") + theme(axis.text.y = element_text(colour = "black", size = 12)) + theme(axis.text.x = element_text(colour = "black", angle=25,vjust=0.5,hjust=0.5, size = 8)) + theme(legend.position = "none") + ggtitle("Immunological Events -> VAERS IDs vs AGE GROUPS")
AGE_GROUPS_IMMUNO_ALL_ID_plot
AGE_GROUPS_IMMUNO_ALL_ID_skew <- data.frame(AGE_GROUPS_IMMUNO_ALL_ID, stringsAsFactors = FALSE) %>% mutate("skew" = 3*(mean(n)-median(n))/(sd(n)))
#AGE_GROUPS_IMMUNO_ALL_ID_skew
```
```{r}
Table_IDs_percent <- data.frame(
  DATE = as.Date(c("1/16/21", "1/23/21", "1/30/21", "2/13/21", "2/27/21", "3/5/21", "3/12/21", "3/19/21", "3/26/21", "4/2/21", "4/9/21", "4/16/21", "4/23/21", "4/30/21", "5/7/21", "5/14/21", "5/21/21", "5/28/21", "6/4/21"), "%m/%d/%y"),
  IDs = as.numeric(c("1431", "2160", "2946", "5351", "9286", "14701", "20586", "27955", "34121", "40348", "46163", "57641", "75370", "108191", "146622", "182559", "217716", "252523", "284041")),
  FV = as.numeric(c("4582089", "7664179", "11037313", "18895522", "27167910", "31720149", "35000000", "44145522", "48700000", "57980000", "64420000", "80610000", "89250000", "99670000", "108930000", "118990000", "126610000", "132770000", "136640000")),
  US_population = as.numeric(c("330175152" , "330175733" , "330176314", "330176895", "330177476", "330178057", "330178638", "330179219", "330179800", "330180381", "330193928", "330209443", "330244315", "330239326", "330757983", "332700813", "332738974", "332371755", "332393075")),
  DEATH = as.numeric(c("137", "281", "456", "810", "984", "1162", "1419", "1561", "1957", "2149", "2240", "2500", "3084", "3442", "3731", "4015", "4169", "4372", "4547")),
  HOSPITAL = as.numeric(c("338", "607", "953", "1747", "2195", "2676", "3412", "3913", "4387", "4758", "4906", "5009", "6215", "8099", "10648", "11557", "12625", "14977", "17520")), 
  ER = as.numeric(c("338", "576", "847", "1493", "2187", "2980", "3855", "4763", "5529", "6329", "6983", "8084", "10375", "14553", "19620", "23641", "27774", "32547", "37184")),
  SAE = as.numeric(c("625", "1101", "1668", "2977", "4017", "5193", "6648", "8000", "9268", "10350", "10484", "12464", "15713", "21158", "27642", "32277", "37000", "44860", "51068")),
  SAE_new = as.numeric(c("690", "1207", "1806", "3221", "4291", "5535", "7065", "8470", "9796", "10930", "11724", "13057", "16478", "22145", "29024", "33791", "38650", "44860", "51068")),
  COVID = as.numeric(c("194", "254", "326", "619", "717", "776", "943", "1057", "1169", "1267", "1375", "1404", "1587", "1930", "2776", "3317", "3742", "4285", "4850")), 
  CV = as.numeric(c("271", "417", "586", "1088", "1794", "2707", "3768", "5049", "6079", "7200", "8194", "9872", "12999", "18834", "25254", "31437", "37577", "43979", "50307")),
  NEURO = as.numeric(c("157", "223", "307", "538", "963", "1583", "2347", "3370", "4024", "4706", "5303", "6413", "8122", "11693", "15741", "19493", "23358", "26834", "30369")),
  IMMUNO = as.numeric(c("310", "425", "523", "930", "2360", "4533", "6406", "9150", "11663", "14041", "16480", "21146", "28070", "40021", "54723", "68836", "81954", "92780", "105264")),
  FRI = as.numeric(c("4", "7", "8", "24", "34", "43", "67", "77", "88", "98", "105", "123", "165", "287", "436", "597", "774", "1067", "1421")),
  
  stringsAsFactors = FALSE
)
#Table_IDs_percent
```
```{r} 
Table_IDs_percent <- Table_IDs_percent %>% mutate("IDs_normal_ID" = IDs/nrow(MERGED_SYM_DAT_VAX_06_04_21_191800kb)*100)
```
```{r}
SAE_calculations <- Table_IDs_percent %>% mutate("SAE_p_FV" = SAE/(FV/1000000)) %>% mutate("SAE_p_mill_doses" = SAE_p_FV/(2.21)) #cum num of doses/FV population = 279400000/126610000 = 2.21
#SAE_calculations
```
```{r}
IDs = as.numeric(c("1431", "2160", "2946", "5351", "9286", "14701", "20586", "27955", "34121", "40348", "46163", "57641", "75370", "108191", "146622", "182559", "217716", "252523", "284041"))
#(diff(IDs)/(IDs))*100
```
```{r}
Table_IDs_percent_FV_IDs <- Table_IDs_percent %>% mutate("DEATH_PERCENT_ID" = DEATH/IDs*100) %>% mutate("H_PERCENT_ID" = HOSPITAL/IDs*100) %>% mutate("ER_PERCENT_ID" = ER/IDs*100) %>% mutate("SAE_new_PERCENT_ID" = SAE/IDs*100) %>% mutate("COVID_PERCENT_ID" = COVID/IDs*100) %>% mutate("CV_PERCENT_ID" = CV/IDs*100) %>% mutate("NEURO_PERCENT_ID" = NEURO/IDs*100) %>% mutate("IMMUNO_PERCENT_ID" = IMMUNO/IDs*100) %>% mutate("FRI_PERCENT_ID" = FRI/IDs*100) %>% mutate("DEATH_PERCENT_FV" = DEATH/FV*100) %>% mutate("H_PERCENT_FV" = HOSPITAL/FV*100) %>% mutate("ER_PERCENT_FV" = ER/FV*100) %>% mutate("SAE_new_PERCENT_FV" = SAE/FV*100) %>% mutate("COVID_PERCENT_FV" = COVID/FV*100) %>% mutate("CV_PERCENT_FV" = CV/FV*100) %>% mutate("NEURO_PERCENT_FV" = NEURO/FV*100) %>% mutate("IMMUNO_PERCENT_FV" = IMMUNO/FV*100) %>% mutate("FRI_PERCENT_FV" = FRI/FV*100)
#Table_IDs_percent_FV_IDs
```
```{r}
Table_IDs_percent_normalized_US_pop <- Table_IDs_percent_FV_IDs %>% mutate("IDs_norm_US_pop" = IDs/(US_population/1000000)) 
#Table_IDs_percent_normalized_US_pop

Table_IDs_percent_normalized_FV <- Table_IDs_percent_FV_IDs %>% mutate("IDs_norm_FV" = IDs/(FV/1000000)) 
#Table_IDs_percent_normalized_FV

Table_AEs_percent_normalized_per_million <- Table_IDs_percent_FV_IDs %>% mutate("Death_norm_per_million" = DEATH/(FV/1000000)) %>% mutate("Hospital_norm_per_million" = HOSPITAL/(FV/1000000)) %>% mutate("ER_norm_per_million" = ER/(FV/1000000)) %>% mutate("SAE_new_norm_per_million" = SAE/(FV/1000000)) %>% mutate("COVID_norm_per_million" = COVID/(FV/1000000)) %>% mutate("CV_norm_per_million" = CV/(FV/1000000)) %>% mutate("NEURO_norm_per_million" = NEURO/(FV/1000000)) %>% mutate("IMMUNO_norm_per_million" = IMMUNO/(FV/1000000)) %>% mutate("FRI_norm_per_million" = FRI/(FV/1000000))
#Table_AEs_percent_normalized_per_million
```
```{r}
Table_IDs_all_VAERS <- data.frame(
  DATE = as.double(c("1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021")),
  IDs = as.numeric(c("2787", "16657", "18392", "17655", "18441", "17794", "17592", "17247", "15997", "20072", "23113", "25492", "26852", "31248", "28663", "28664", "31353", "48349", "51019", "50524", "49601", "41200", "41149", "43335", "47165", "57224", "60450", "52751", "62305", "61204", "55833", "62000")),
  US_Pop = as.numeric(c("252120309", "254539370", "256990613", "259532129", "262241196", "265163745", "268335003" ,"271713635", "275175301", "278548150", "281710909", "284607993", "287279318", "289815562", "292354658", "294993511", "297758969", "300608429", "303486012", "306307567", "309011475", "311584047", "314043885", "316400538", "318673411", "320878310" ,"323015995", "325084756", "327096265", "329064917", "331002651", "332915073")),
  
  stringsAsFactors = FALSE
)
Table_IDs_all_VAERS <- Table_IDs_all_VAERS %>% mutate("NORMALIZED" = IDs/(US_Pop/1000000))
#Table_IDs_all_VAERS
```
```{r}
Table_IDs_all_VAERS_plot <- ggplot(data = Table_IDs_all_VAERS, aes(DATE, IDs, colour = "IDs")) + geom_line(data = Table_IDs_all_VAERS, aes(DATE, IDs, colour = "IDs"), colour = "red", size = 2) + geom_point(data = Table_IDs_all_VAERS, aes(DATE, IDs, colour = "IDs"), colour = "red", size = 5) + xlab("DATE") + ylab("ABSOLUTE NUMBER OF VAERS IDs (N)") + labs(title = "Change in absolute number of VAERS IDs per year", caption = "Data source: VAERS", size = 12) + theme(axis.text.y = element_text(colour = "#000000", size = 14)) + theme(axis.text.x = element_text(angle=0,vjust=0.5,hjust=0.5, size = 14)) + theme(panel.background = element_rect(fill = "#100000")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + theme(legend.title=element_blank()) + theme(legend.background = element_rect(fill = "white"), legend.key = element_rect(fill = "black", color = NA), legend.key.size = unit(0.5, "cm"), legend.key.width = unit(0.5,"cm")) + geom_smooth(method = "lm", se=FALSE, color="blue", aes(group=1))
#Table_IDs_all_VAERS_plot
```
VAERS ID COUNTS NORMALIZED TO U.S. POPULATION - blue line is best fit to approximate count for 2021
```{r}
#png("Table_IDs_all_VAERS_plot_norm_US.png", width = 4, height = 4, units = 'in', res = 100)

Table_IDs_all_VAERS_plot_norm_US <- ggplot(data = Table_IDs_all_VAERS, aes(DATE, NORMALIZED, colour = "NORMALIZED")) + geom_line(data = Table_IDs_all_VAERS, aes(DATE, NORMALIZED, colour = "NORMALIZED"), colour = "red", size = 2) + geom_point(data = Table_IDs_all_VAERS, aes(DATE, NORMALIZED, colour = "NORMALIZED"), colour = "red", size = 5) + xlab("DATE") +  ylab("VAERS ID rate normalized/million U.S. popln") + labs(title = "VAERS ADVERSE EVENT COUNTS OVER THE YEARS", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 14)) + theme(panel.background = element_rect(fill = "#100000")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + theme(legend.title=element_blank()) + theme(legend.background = element_rect(fill = "white"), legend.key = element_rect(fill = "black", color = NA), legend.key.size = unit(0.5, "cm"), legend.key.width = unit(0.5,"cm")) + geom_smooth(method = "lm", se=FALSE, color="blue", aes(group=1)) #+ geom_text(aes(label = IDs), color = "white", size = 4) 
Table_IDs_all_VAERS_plot_norm_US
```
Cumulative AEs by ID (red), ID count per update as per total ID count (blue), and ID count normalized to million fully vaxxed (yellow). 
```{r}
#png("Table_IDs_plot.png", width = 4, height = 4, units = 'in', res = 100)

Table_IDs_plot <- ggplot(data = Table_IDs_percent, aes(x = DATE, y = IDs)) + geom_line(data = Table_IDs_percent, aes(x = DATE, y = IDs, colour = "IDs"), colour = "red", size = 2) + geom_point(data = Table_IDs_percent, aes(DATE, IDs, colour = "IDs"), colour = "red", size = 5) + xlab("DATE") +  ylab("Absolute number of VAERS IDs (N)") + labs(title = "Cumulative VAERS AEs", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=15,vjust=0.5,hjust=0.5, size = 10)) + theme(panel.background = element_rect(fill = "black")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + theme(legend.title=element_blank()) + scale_x_continuous(breaks = round(seq(min(Table_IDs_percent$DATE), max(Table_IDs_percent$DATE), by = 10),0.1)) + ylim(0,300000)
Table_IDs_plot

Table_IDs_plot_norm <- ggplot(data = Table_IDs_percent, aes(x = DATE, y = IDs_normal_ID)) + geom_line(data = Table_IDs_percent, aes(x = DATE, y = IDs_normal_ID, colour = "IDs_normal_ID"), colour = "blue", size = 2) + geom_point(data = Table_IDs_percent, aes(DATE, IDs_normal_ID, colour = "IDs_normal_ID"), colour = "blue", size = 5) + xlab("DATE") +  ylab("VAERS IDs normalized to total ID count") + labs(title = "VAERS AES normalized to Total ID count", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=15,vjust=0.5,hjust=0.5, size = 10)) + theme(panel.background = element_rect(fill = "black")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + theme(legend.title=element_blank()) + scale_x_continuous(breaks = round(seq(min(Table_IDs_percent$DATE), max(Table_IDs_percent$DATE), by = 10),0.1)) 
Table_IDs_plot_norm

Table_IDs_plot_norm_FV <- ggplot(data = Table_IDs_percent_normalized_FV, aes(x = DATE, y = IDs_norm_FV)) + geom_line(data = Table_IDs_percent_normalized_FV, aes(x = DATE, y = IDs_norm_FV, colour = "IDs_norm_FV"), colour = "yellow", size = 2) + geom_point(data = Table_IDs_percent_normalized_FV, aes(DATE, IDs_norm_FV, colour = "IDs_norm_FV"), colour = "yellow", size = 5) + xlab("DATE") +  ylab("IDs normalized/million FV popln") + labs(title = "VAERS AES normalized/million U.S. population Fully Injected", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=15,vjust=0.5,hjust=0.5, size = 10)) + theme(panel.background = element_rect(fill = "black")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + theme(legend.title=element_blank()) + scale_x_continuous(breaks = round(seq(min(Table_IDs_percent_normalized_FV$DATE), max(Table_IDs_percent_normalized_FV$DATE), by = 10),0.1)) 
Table_IDs_plot_norm_FV
ggsave("Table_IDs_plot_norm_FV.png")
```
CUMULATIVE NUMBER OF ADVERSE EVENTS AS PER AE GROUP
```{r}
Table_IDs_percent_plot <- ggplot() + geom_line(data = Table_IDs_percent_FV_IDs, aes(DATE, DEATH, colour = "DEATH"), size = 2) + xlab("DATE") +  ylab("Absolute number of VAERS IDs (N)") + geom_line(data = Table_IDs_percent_FV_IDs, aes(DATE, HOSPITAL, colour = "HOSPITAL"), size = 2) + geom_line(data = Table_IDs_percent_FV_IDs, aes(DATE, ER, colour = "ER"), size = 2) + geom_line(data = Table_IDs_percent_FV_IDs, aes(DATE, CV, colour = "CV"), size = 2) + geom_line(data = Table_IDs_percent_FV_IDs, aes(DATE, NEURO, colour = "NEURO"), size = 2) + geom_line(data = Table_IDs_percent, aes(DATE, IMMUNO, colour = "IMMUNO"), size = 2) + geom_line(data = Table_IDs_percent, aes(DATE, FRI, colour = "FRI"), size = 2) + geom_line(data = Table_IDs_percent, aes(DATE, COVID, colour = "COVID"), size = 2) + geom_line(data = Table_IDs_percent, aes(DATE, SAE_new, colour = "SAE_new"), size = 2) + labs(title = "CUMULATIVE COVID-19 PRODUCT-RELATED GROUPED AES", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 14)) + theme(panel.background = element_rect(fill = "#100000")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + theme(legend.title=element_blank()) + theme(legend.background = element_rect(fill = "white"), legend.key = element_rect(fill = "black", color = NA), legend.key.size = unit(0.5, "cm"), legend.key.width = unit(0.5,"cm")) #+ ylim(0,100000)
Table_IDs_percent_plot
```
CUMULATIVE NUMBER OF VAERS IDS AS PER AE GROUP PER MILLION FULLY VAXXED (FV)
```{r}
#png("Table_IDs_FV_per_million", width = 4, height = 4, units = 'in', res = 100)

Table_IDs_FV_per_million <- ggplot() + geom_line(data = Table_AEs_percent_normalized_per_million, aes(DATE, Death_norm_per_million, colour = "DEATH"), size = 2) + xlab("DATE") +  ylab("Grouped adverse events per million FV") + geom_line(data = Table_AEs_percent_normalized_per_million, aes(DATE, Hospital_norm_per_million, colour = "HOSPITAL"), size = 2) + geom_line(data = Table_AEs_percent_normalized_per_million, aes(DATE, ER_norm_per_million, colour = "ER"), size = 2) + geom_line(data = Table_AEs_percent_normalized_per_million, aes(DATE, CV_norm_per_million, colour = "CV"), size = 2) + geom_line(data = Table_AEs_percent_normalized_per_million, aes(DATE,NEURO_norm_per_million, colour = "NEURO"), size = 2) + geom_line(data = Table_AEs_percent_normalized_per_million, aes(DATE, IMMUNO_norm_per_million, colour = "IMMUNO"), size = 2) + geom_line(data = Table_AEs_percent_normalized_per_million, aes(DATE, FRI_norm_per_million, colour = "FRI"), size = 2) + geom_line(data = Table_AEs_percent_normalized_per_million, aes(DATE, COVID_norm_per_million, colour = "COVID"), size = 2) + geom_line(data = Table_AEs_percent_normalized_per_million, aes(DATE, SAE_new_norm_per_million, colour = "SAE_new"), size = 2) + labs(title = "VAERS AES PER MILLION U.S. FULLY VAXXED (FV)", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 12)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 12)) + theme(panel.background = element_rect(fill = "#100000")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + theme(legend.title=element_blank()) + theme(legend.background = element_rect(fill = "white"), legend.key = element_rect(fill = "black", color = NA), legend.key.size = unit(0.5, "cm"), legend.key.width = unit(0.5,"cm")) #+ ylim(0,800)
Table_IDs_FV_per_million
```
THE FOLLOWING IS A NEW ADVERSE EVENT GROUP THAT I CREATED BY WRITING A FUNCTION THAT PULLS OUT AES BY KEYWORD. THIS NEW AE GROUP INCLUDED FEMALE REPRODUCTIVE ISSUES THAT OCCURRED IN WOMEN POST-INJECTION.
```{r}
strings_FRI <- c("Abnormal uterine bleeding", "Afterbirth pain", "Dysmenorrhoea", "Female reproductive tract disorder", "Female sex hormone level", "Female reproductive tract disorder", "Alpha 1 foetoprotein abnormal", "Heavy menstrual bleeding", "Intermenstrual bleeding", "Intra-uterine contraceptive device removal", "Menstrual disorder", "Menstruation delayed", "Menstruation irregular", "Premenstrual syndrome", "Abortion spontaneous", "Abortion spontaneous incomplete", "Uterine leiomyoma", "Uterine haemorrhage", "Uterine spasm", "Bradycardia foetal", "Biopsy foetal", "Bradycardia foetal", "Foetal cystic hygroma", "Foetal death", "Foetal exposure during pregnancy", "Foetal heart rate abnormal", "Foetal hypokinesia", "Foetal non-stress test abnormal", "Female sex hormone level", "Amenorrhoea", "Hypomenorrhoea", "Menopause", "Menorrhagia", "Oligomenorrhoea", "Polymenorrhoea", "Postmenopausal haemorrhage", "Postmenopause", "Vaginal discharge", "Vaginal disorder", "Vaginal erosion", "Vaginal haemorrhage", "Vaginal lesion", "Vaginal infection", "Vulvovaginal mycotic infection", "Vulval ulceration", "Vulval abscess", "Vulva cyst", "Cervix inflammation", "Adenocarcinoma of the cervix", "Cervix carcinoma", "Amniorrhoea", "Amniotic cavity infection", "Amniotic membrane rupture test positive", "Amniotic fluid index decreased")
```
```{r}
FRI <- function(SYMPTOM) {
  if(str_detect(SYMPTOM, paste(strings_FRI, collapse = "|"))) {
      FRI = "Female_Reprod_Issues"
      } 
        else {
          FRI = "NA"
      }
    return(FRI)
}
```
```{r}
FRI_CASES <- MERGED_SYM_DAT_VAX_06_04_21_191800kb %>% rowwise() %>% filter(SYMPTOM != "NA") %>% mutate("Female_Reprod_Issues" = FRI(SYMPTOM)) %>% filter(Female_Reprod_Issues != "NA")
```
```{r}
nrow(FRI_CASES)
```
```{r}
FRI_CASES_count <- FRI_CASES %>% group_by(Female_Reprod_Issues, ONSET_DATE, VAX_DATE) %>% filter(year(ONSET_DATE) <= 2021 & year(ONSET_DATE) >= 2021) %>% filter(year(VAX_DATE) <= 2021 & year(VAX_DATE) >= 2021) %>% count(Female_Reprod_Issues) %>% arrange(desc(n))
FRI_CASES_count_week <- FRI_CASES_count
FRI_CASES_count_week$week <- week(FRI_CASES_count_week$ONSET_DATE)
FRI_CASES_count_week_count <- FRI_CASES_count_week %>% group_by(week) %>% arrange(desc(ONSET_DATE))
#FRI_CASES_count_week_count
```
```{r}
FRI_plot <- ggplot(data = FRI_CASES_count_week_count, aes(x = ONSET_DATE, y = n)) + geom_point(data = FRI_CASES_count_week_count, aes(ONSET_DATE, n), colour = "red", size = 5) + ylab("Number of FRIs (N)") + labs(title = "FRIs FOR 2021", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "#000000", size = 12)) + theme(axis.text.x = element_text(angle=0,vjust=0.5,hjust=0.5, size = 12)) + theme(panel.background = element_rect(fill = "#100000")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) #+ scale_x_continuous(breaks = round(seq(min(SAE_count_week_count$n), max(SAE_count_week_count$n), by = 1),1))
#FRI_plot 
```
```{r}
FRI_CASES_AG <- FRI_CASES %>% rowwise() %>% filter(AGE_YRS != "NA") %>% mutate("AGE_GROUP" = AGE_GROUPED_BY_DECADE(AGE_YRS))
FRI_CASES_AG_count <- FRI_CASES_AG %>% group_by(AGE_GROUP) %>% filter(AGE_GROUP != "NA") %>% count(AGE_GROUP)
FRI_CASES_AG_plot <- ggplot(FRI_CASES_AG_count, aes(AGE_GROUP, n, fill = AGE_GROUP)) + geom_bar(stat = "Identity") + geom_text(aes(label = n)) + xlab("AGE GROUPS") + ylab("NUMBER OF FRI AEs") + theme(axis.text.y = element_text(colour = "black", size = 12)) + theme(axis.text.x = element_text(colour = "black", angle=25,vjust=0.5,hjust=0.5, size = 8)) + theme(legend.position = "none") + ggtitle("Female Reproductive Issues -> VAERS IDs vs AGE GROUPS")
FRI_CASES_AG_plot
FRI_CASES_AG_plot_skew <- data.frame(FRI_CASES_AG_count, stringsAsFactors = FALSE) %>% mutate("skew" = 3*(mean(n)-median(n))/(sd(n)))
#FRI_CASES_AG_plot_skew
```
```{r}
FRI_new <- data.frame(FRI_CASES, stringsAsFactors = FALSE) %>% filter(year(ONSET_DATE) <= 2021 & year(ONSET_DATE) >= 2020) 
MERGED_SYM_DAT_VAX_06_04_21_191800kb_FRI_new_VD_OD <- FRI_new %>% mutate("diff_in_days" = difftime(ONSET_DATE, VAX_DATE, units = "days")) %>% filter(diff_in_days >= 0 & diff_in_days <=50) %>% count(diff_in_days) %>% arrange(desc(n))  %>% mutate("OBSERVED" = n) %>% mutate("Percentage_OBSERVED" = n/nrow(FRI_new)*100) %>% mutate("EXPECTED" = mean(n)) %>% mutate("EXPECTED" = mean(n)) %>% mutate("Percentage_EXPECTED" = EXPECTED/nrow(FRI_new)*100)
#head(MERGED_SYM_DAT_VAX_06_04_21_191800kb_FRI_new_VD_OD)

#chisq.test(MERGED_SYM_DAT_VAX_06_04_21_191800kb_FRI_new_VD_OD$OBSERVED)
```
```{r}
#png("CAUSATION_IMMUNO_plot", width = 4, height = 4, units = 'in', res = 100)

CAUSATION_FRI_new_plot <- ggplot() + geom_line(data = MERGED_SYM_DAT_VAX_06_04_21_191800kb_FRI_new_VD_OD, aes(diff_in_days, Percentage_OBSERVED), colour = "orange", size = 2) + xlab("NUMBER OF DAYS FOLLOWING INJECTION") +  ylab("PERCENTAGE OF REPORTED FRI AEs") + geom_line(data = MERGED_SYM_DAT_VAX_06_04_21_191800kb_FRI_new_VD_OD, aes(diff_in_days, Percentage_EXPECTED), colour = "yellow", size = 2) + labs(title = "Female Reproductive Issues post injection", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 14)) + theme(panel.background = element_rect(fill = "#100000", color = "pink")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
CAUSATION_FRI_new_plot
CAUSATION_FRI_new_plot_closeup <- ggplot() + geom_line(data = MERGED_SYM_DAT_VAX_06_04_21_191800kb_FRI_new_VD_OD, aes(diff_in_days, Percentage_OBSERVED), colour = "orange", size = 2) + xlab("NUMBER OF DAYS FOLLOWING INJECTION") +  ylab("PERCENTAGE OF REPORTED FRI AEs") + geom_line(data = MERGED_SYM_DAT_VAX_06_04_21_191800kb_FRI_new_VD_OD, aes(diff_in_days, Percentage_EXPECTED), colour = "yellow", size = 2) + labs(title = "Female Reproductive Issues post injection", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 14)) + theme(panel.background = element_rect(fill = "#100000", color = "pink")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + ylim(0,7)
CAUSATION_FRI_new_plot_closeup
```
```{r}
MERGED_SYM_DAT_VAX_06_04_21_191800kb_FEM <- MERGED_SYM_DAT_VAX_06_04_21_191800kb %>% filter(SEX == "F") 
#nrow(MERGED_SYM_DAT_VAX_06_04_21_191800kb_FEM)
FRI_CASES_perc <- FRI_CASES %>% count(SYMPTOM) %>% arrange(desc(n)) %>% mutate("PERC" = n/nrow(MERGED_SYM_DAT_VAX_06_04_21_191800kb_FEM)*100)
#FRI_CASES_perc
```
```{r}
FRI_CASES_count_plot <- ggplot(FRI_CASES_perc, aes(n, SYMPTOM, fill = SYMPTOM)) + geom_bar(stat = "Identity") + geom_text(aes(label = n)) + ylab("SYMPTOM") + xlab("Number of Female Reproductive Disorders") + theme(axis.text.y = element_text(colour = "black", size = 6)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 10)) + theme(legend.position = "none") + ggtitle("Numbers of Female Reproductive Adverse Event types")
FRI_CASES_count_plot
```