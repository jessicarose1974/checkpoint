---
title: "The R Markdown document for VAERS analysis"
author: "Dr. Jessica Rose"
date: "2021-05-21"
output: html_document
---

This is an R Markdown sheet generated from the VAERS data. I included some code but for the most part, only figures are shown. I decided to show figures pertaining to Death, Spontaneous abortions, Breakthrough COVID-19 infections and Cardiovascular, Neurological and Immunological adverse events.

I start by coalescing the .csv files downloaded from the VAERS website: https://vaers.hhs.gov/data/datasets.html
```{r global-options, include=FALSE}
knitr::opts_chunk$set(fig.width=7, fig.height=5, fig.path='Figs/',
                      echo=FALSE, warning=FALSE, message=FALSE)
```
```{r}
library("readr")
library("tidyverse")
library("dplyr")
library("ggplot2")
library("stringr")
library("DT")
library("reshape2")
library("data.table")
library("plotly")
```
```{r}
VAERSSYM_2021_paper <- read_csv("/Users/admin/Downloads/2021VAERSData_05_21_21_151700kb/2021VAERSSYMPTOMS.csv", col_types = cols(VAERS_ID = col_double()))
RV_05_21_21_151700kb <- VAERSSYM_2021_paper %>% select(VAERS_ID, SYMPTOM1, SYMPTOM2, SYMPTOM3, SYMPTOM4, SYMPTOM5)
```
```{r}
SYMPTOM1_LIST_05_21_21_151700kb <- RV_05_21_21_151700kb %>% select(VAERS_ID, SYMPTOM1) %>% rename(SYMPTOM = SYMPTOM1) %>% filter(SYMPTOM != "NA")
Total_number_SYMPTOM1_LIST_05_21_21_151700kb <- SYMPTOM1_LIST_05_21_21_151700kb %>% group_by(VAERS_ID, SYMPTOM) %>% count(SYMPTOM)
SYMPTOM2_LIST_05_21_21_151700kb <- RV_05_21_21_151700kb %>% select(VAERS_ID, SYMPTOM2) %>% rename(SYMPTOM = SYMPTOM2) %>% filter(SYMPTOM != "NA")
Total_number_SYMPTOM2_LIST_05_21_21_151700kb <- SYMPTOM2_LIST_05_21_21_151700kb %>% group_by(VAERS_ID, SYMPTOM) %>% count(SYMPTOM)
SYMPTOM3_LIST_05_21_21_151700kb <- RV_05_21_21_151700kb %>% select(VAERS_ID, SYMPTOM3) %>% rename(SYMPTOM = SYMPTOM3) %>% filter(SYMPTOM != "NA")
Total_number_SYMPTOM3_LIST_05_21_21_151700kb <- SYMPTOM3_LIST_05_21_21_151700kb %>% group_by(VAERS_ID, SYMPTOM) %>% count(SYMPTOM)
SYMPTOM4_LIST_05_21_21_151700kb <- RV_05_21_21_151700kb %>% select(VAERS_ID, SYMPTOM4) %>% rename(SYMPTOM = SYMPTOM4) %>% filter(SYMPTOM != "NA")
Total_number_SYMPTOM4_LIST_05_21_21_151700kb <- SYMPTOM4_LIST_05_21_21_151700kb %>% group_by(VAERS_ID, SYMPTOM) %>% count(SYMPTOM)
SYMPTOM5_LIST_05_21_21_151700kb <- RV_05_21_21_151700kb %>% select(VAERS_ID, SYMPTOM5) %>% rename(SYMPTOM = SYMPTOM5) %>% filter(SYMPTOM != "NA")
Total_number_SYMPTOM5_LIST_05_21_21_151700kb <- SYMPTOM5_LIST_05_21_21_151700kb %>% group_by(VAERS_ID, SYMPTOM) %>% count(SYMPTOM)
```
```{r}
ALL_SYMPTOMS_05_21_21_151700kb <- rbind(SYMPTOM1_LIST_05_21_21_151700kb, SYMPTOM2_LIST_05_21_21_151700kb, SYMPTOM3_LIST_05_21_21_151700kb, SYMPTOM4_LIST_05_21_21_151700kb, SYMPTOM5_LIST_05_21_21_151700kb)
```
```{r}
VAERSDATA_05_21_21_151700kb <- read.csv("/Users/admin/Downloads/2021VAERSData_05_21_21_151700kb/2021VAERSDATA_fewer_columns.csv", stringsAsFactors = FALSE)
RV_DATA_05_21_21_151700kb <- VAERSDATA_05_21_21_151700kb %>% select(VAERS_ID, STATE, AGE_YRS,	SEX,	DIED,	DATEDIED,	HOSPITAL,	VAX_DATE,	ONSET_DATE,	TODAYS_DATE, ER_ED_VISIT) 
#RV_DATA_05_21_21_151700kb

RV_DATA_05_21_21_151700kb$VAX_DATE <- as.Date(RV_DATA_05_21_21_151700kb$VAX_DATE, "%m/%d/%y") 
RV_DATA_05_21_21_151700kb$ONSET_DATE <- as.Date(RV_DATA_05_21_21_151700kb$ONSET_DATE, "%m/%d/%y")
RV_DATA_05_21_21_151700kb$DATEDIED <- as.Date(RV_DATA_05_21_21_151700kb$DATEDIED, "%m/%d/%y")
RV_DATA_05_21_21_151700kb$TODAYS_DATE <- as.Date(RV_DATA_05_21_21_151700kb$TODAYS_DATE, "%m/%d/%y")
```
```{r}
VAERSVAX_05_21_21_151700kb <- read_csv("/Users/admin/Downloads/2021VAERSData_05_21_21_151700kb/2021VAERSVAX.csv", col_types = cols(VAERS_ID = col_double()))
RV_VAX_05_21_21_151700kb <- VAERSVAX_05_21_21_151700kb %>% select(VAERS_ID, VAX_TYPE, VAX_MANU, VAX_LOT, VAX_DOSE_SERIES, VAX_ROUTE, VAX_SITE, VAX_NAME) %>% filter(VAX_TYPE == "COVID19")
```
```{r}
MERGED_SYM_DAT_05_21_21_151700kb <- full_join(ALL_SYMPTOMS_05_21_21_151700kb, RV_DATA_05_21_21_151700kb, by = c("VAERS_ID"))
MERGED_SYM_DAT_VAX_05_21_21_151700kb <- full_join(MERGED_SYM_DAT_05_21_21_151700kb, RV_VAX_05_21_21_151700kb, by = c("VAERS_ID"))
MERGED_SYM_DAT_VAX_05_21_21_151700kb <- subset(MERGED_SYM_DAT_VAX_05_21_21_151700kb, !duplicated(subset(MERGED_SYM_DAT_VAX_05_21_21_151700kb, select=c(VAERS_ID))))
MERGED_SYM_DAT_VAX_05_21_21_151700kb_count_sym <- MERGED_SYM_DAT_VAX_05_21_21_151700kb %>% group_by(SYMPTOM) %>% count(SYMPTOM) %>% arrange(desc(n))
#MERGED_SYM_DAT_VAX_05_21_21_151700kb_count_sym
MERGED_SYM_DAT_VAX_05_21_21_151700kb_female <- MERGED_SYM_DAT_VAX_05_21_21_151700kb %>% group_by(SEX) %>% count(SEX) %>% mutate("PERC_FEMALE" = n/nrow(MERGED_SYM_DAT_VAX_05_21_21_151700kb)*100)
#MERGED_SYM_DAT_VAX_05_21_21_151700kb_female
#MERGED_SYM_DAT_VAX_05_21_21_151700kb
```
```{r}
D_05_21_21_151700kb <- MERGED_SYM_DAT_VAX_05_21_21_151700kb %>% group_by(VAERS_ID, DIED) %>% filter(DIED == "Y")
DEAD_05_21_21_151700kb <- subset(D_05_21_21_151700kb, !duplicated(subset(D_05_21_21_151700kb, select=c(VAERS_ID))))
#nrow(DEAD_05_21_21_151700kb)
```
```{r}
DEAD_Y_05_21_21_151700kb <- MERGED_SYM_DAT_VAX_05_21_21_151700kb %>% group_by(DIED) %>% filter(DIED == "Y")
HOSPITAL_Y_05_21_21_151700kb <- MERGED_SYM_DAT_VAX_05_21_21_151700kb %>% group_by(HOSPITAL) %>% filter(HOSPITAL == "Y")
ER_ED_Y_05_21_21_151700kb <- MERGED_SYM_DAT_VAX_05_21_21_151700kb %>% group_by(ER_ED_VISIT) %>% filter(ER_ED_VISIT == "Y")
SAES_05_21_21_151700kb <- rbind(DEAD_Y_05_21_21_151700kb, HOSPITAL_Y_05_21_21_151700kb, ER_ED_Y_05_21_21_151700kb) 
SAES_no_dups_05_21_21_151700kb <- subset(SAES_05_21_21_151700kb, !duplicated(subset(SAES_05_21_21_151700kb, select=c(VAERS_ID))))
#nrow(SAES_no_dups_05_21_21_151700kb)
Percent = nrow(SAES_no_dups_05_21_21_151700kb)/nrow(MERGED_SYM_DAT_VAX_05_21_21_151700kb)*100
#Percent
```
SEVERE ADVERSE EVENTS (SAE) COMPARED TO VAERS (SAE) STANDARD (15%) - CONSISTENTLY HIGHER
```{r}
Table_SAEs <- data.frame(
  Percent_SAE = c("Standard", "Actual"),
  SAE = as.numeric(c("32657", "37000")),
  
  stringsAsFactors = FALSE
)
Table_SAEs_perc <- Table_SAEs %>% mutate("PERC" = round(SAE/(nrow(MERGED_SYM_DAT_VAX_05_21_21_151700kb))*100))
#head(Table_SAEs_perc)

Table_SAEs_perc_plot <- ggplot(Table_SAEs_perc, aes(Percent_SAE, PERC, fill = Percent_SAE)) + geom_bar(stat = 'identity') + geom_text(aes(label = PERC)) + ylab("% VAERS SAE REPORTS") + theme(axis.text.y = element_text(colour = "#000000", size = 12)) + theme(axis.text.x = element_text(angle=0,vjust=0.5,hjust=0.5, size = 12)) + theme(legend.position = "none") + ggtitle("SAEs -> Comparison of Standard versus actual % reports")
Table_SAEs_perc_plot
```
```{r}
strings_heart <- c("Angina pectoris", "Angina unstable", "Acute coronary syndrome", "Angioedema", "Angiogram abnormal", "Angiopathy", "Angiplasty", "Aortic arteriosclerosis", "Aortic valve calcification", "Aortic valve incompetence", "Arrhythmia", "Atelectasis", "Atrial tachycardia", "Arteriogram carotid abnormal", "Arteriogram coronary abnormal", "Arteriospasm coronary", "Arteriovenous fistula aneurysm", "Atrial enlargement", "Atrial flutter", "Atrial tachycardia", "Cardiac ablation", "Cardiac arrest", "Cardiac discomfort", "Cardiac disorder", "Cardiac failure chronic", "Cardiac failure congestive", "Cardiac flutter", "Cardiac monitoring abnormal", "Cardiac murmur", "Cardiac pademaker evaluation", "Cardiac stress test", "Cardiac telemetry abnormal", "Cardio-respiratory arrest", "Cardiogenic shock", "Cardiomegaly", "Cardiomyopathy", "Cardioversion", "Carotid arteriosclerosis", "Chest pain", "Coronary arterial stent insertion", "Coronary artery bypass", "Coronary artery disease", "Coronary artery occlusion", "Coronary artery stenosis", "Echocardiogram abnormal", "Electrocardiogram", "Electrocardiogram abnormal", "Electrocardiogram ambulatory", "Electrocardiogram ambulatory abnormal", "Electrocardiogram change", "Electrocardiogram PR prolongation", "Electrocardiogram PR shortened", "Electrocardiogram Q wave abnormal", "Electrocardiogram QRS complex abnormal", "Electrocardiogram QT prolonged", "Electrocardiogram ST segment abnormal", "Electrocardiogram ST segment depression", "Electrocardiogram ST segment elevation", "Endocarditis", "Electrocardiogram T wave abnormal", "Electrocardiogram T wave inversion", "Electrocardiogram T wave peaked", "Foetal heart rate abnormal", "Heart rate abnormal", "Heart rate decreased", "Heart rate increased", "Heart rate irregular", "Heart sounds abnormal", "Heart valve incompetence", "Hypertension", "Magnetic resonance imaging heart", "Microvascular coronary artery disease", "Myocardial infarction", "Myocardial necrosis marker", "Myocardial necrosis marker increased", "Myocardial strain", "Myocarditis", "Palpitations", "Pericardial effusion", "Pericarditis", "Right atrial dilatation", "Right ventricular dilatation", "Right ventricular dysfunction", "Right ventricular ejection fraction decreased", "Right ventricular hypertrophy", "Right ventricular systolic pressure decreased", "Scan myocardial perfusion", "Sinus arrhythmia", "Supraventricular extrasystoles", "Supraventricular tachycardia", "Tachycardia", "Vascular test", "Vasoconstriction", "Vasodilatation", "Vein discolouration", "Venogram abnormal", "Venous stent insertion", "Ventricular arrhythmia", "Ventricular extrasystoles", "Ventricular fibrillation", "Ventricular tachycardia") 
#strings_heart
```
```{r}
strings_circulation_1 <- c("Abdominal wall haematoma", "Aneurysm", "Aneurysm ruptured", "Angioedema", "Angiogram cerebral", "Angiogram cerebral abnormal", "Angiogram pulmonary abnormal", "Angiopathy", "Angioplasty", "Arteriogram carotid abnormal", "Arteriogram coronary abnormal", "Arteriosclerosis", "Arteriosclerosis coronary artery", "Arteriospasm coronary", "Arteriovenous fistula aneurysm", "Basal ganglia haemorrhage", "Blood 1,25-dihydroxycholecalciferol decreased", "Blood albumin decreased", "Blood albumin increased", "Blood alkaline phosphatase increased", "Blood beta-D-glucan increased", "Blood beta-D-glucan positive", "Blood bicarbonate decreased", "Blood bicarbonate increased", "Blood bilirubin decreased", "Blood bilirubin increased", "Blood bilirubin unconjugated", "Blood calcium", "Blood calcium decreased", "Blood chloride decreased", "Blood chloride increased", "Blood cholesterol", "Blood cholesterol increased", "Blood cholesterol decreased", "Blood corticotrophin", "Blood count abnormal", "Blood creatine increased", "Blood creatine abnormal", "Blood creatine phosphokinase abnormal", "Blood creatine phosphokinase decreased", "Blood creatine phosphokinase increased", "Blood creatine phosphokinase MB decreased", "Blood creatine phosphokinase MB increased", "Blood creatinine decreased", "Blood creatinine increased", "Blood culture", "Blood culture positive", "Blood disorder", "Blood fibrinogen", "Blood fibrinogen increased", "Blood gases abnormal", "Blood glucose abnormal", "Blood ketone body increased", "Blood glucose decreased", "Blood glucose increased", "Blood insulin increased", "Blood lactate dehydrogenase", "Blood lactate dehydrogenase increased", "Blood lactic acid", "Blood lactic acid decreased", "Blood lactic acid increased", "Blood magnesium decreased", "Blood magnesium increased", "Blood methaemoglobin", "Blood osmolarity decreased", "Blood osmolarity increased", "Blood parathyroid hormone increased", "Blood pH increased", "Blood phosphorus", "Blood phosphorus decreased", "Blood phosphorus increased", "Blood potassium decreased", "Blood potassium increased", "Blood pressure abnormal", "Blood pressure decreased", "Blood pressure diastolic abnormal", "Blood pressure diastolic increased", "Blood pressure fluctuation", "Blood pressure immeasurable", "Blood pressure increased", "Blood pressure measurement", "Blood pressure orthostatic abnormal", "Blood pressure systolic", "Blood pressure systolic abnormal", "Blood pressure systolic decreased", "Blood pressure systolic increased", "Blood smear test abnormal", "Blood sodium decreased", "Blood sodium increased", "Blood test", "Blood test abnormal", "Blood thyroid stimulating hormone", "Blood thyroid stimulating hormone decreased", "Blood triglycerides increased", "Blood urea decreased", "Blood urea increased", "Blood urea nitrogen/creatinine ratio", "Blood urea nitrogen/creatinine ratio decreased", "Blood urea nitrogen/creatinine ratio increased", "Blood uric acid", "Blood uric acid increased", "Carboxyhaemoglobin decreased", "Cerebellar haemorrhage", "Cerebral haemorrhage")
#strings_circulation_1
strings_circulation_2 <- c("Cerebral microangiopathy", "Cerebral small vessel ischaemic disease", "Cerebral ventricle dilatation", "Cerebrovascular accident", "Circulatory collapse", "Conjunctival haemorrhage", "Cyanosis", "Deep vein thrombosis", "Dizziness", "Dizziness postural", "Exercise tolerance decreased", "Eye haemorrhage", "Fatigue", "Fibrin D dimer increased", "Full blood count abnormal", "Gastrointestinal haemorrhage", "Glycosylated haemoglobin", "Glycosylated haemoglobin decreased", "Glycosylated haemoglobin increased", "Haemarthrosis", "Haematemesis", "Haematochezia", "Haematocrit decreased", "Haematocrit increased", "Haematological malignancy", "Haematoma", "Haematoma muscle", "Haematuria", "Haemodialysis", "Haemodynamic instability", "Haemolysis", "Haemoptysis", "Haemorrhage in pregnancy", "Haemolytic anaemia", "Haemoglobin abnormal", "Haemoglobin decreased", "Haemoptysis", "Haemorrhage", "Haemorrhage intracranial", "Haemorrhagic stroke", "Hypoxic-ischaemic encephalopathy", "Injection site bruising", "Injection site extravasation", "Injection site haematoma", "Injection site haemorrhage", "Injection site streaking", "Internal haemorrhage", "Intra-abdominal haemorrhage", "Intracerebral haematoma evacuation", "Ischaemia", "Ischaemic cardiomyopathy", "Ischaemic stroke", "Lacunar infarction", "Mean cell haemoglobin concentration decreased", "Mean cell haemoglobin concentration increased", "Mean cell haemoglobin decreased", "Mean cell haemoglobin increased", "Microembolism", "NIH stroke scale abnormal",  "Rectal haemorrhage", "Skin haemorrhage", "Subarachnoid haemorrhage", "Subdural haematoma", "Subdural haemorrhage", "Occult blood", "Occult blood positive", "Oxygen saturation abnormal", "Oxygen saturation decreased", "Oxygen therapy", "Pallor", "Penile haemorrhage", "Peripheral vein occlusion", "Phlebitis", "Platelet count", "Platelet count decreased", "Platelet count increased", "Platelet transfusion", "Poor peripheral circulation", "Posthaemorrhagic hydrocephalus", "Presyncope", "Pulse abnormal", "Pulse absent", "Red blood cell count abnormal", "Red blood cell count decreased", "Red blood cell count increased", "Red blood cell nucleated morphology", "Red blood cell nucleated morphology present", "Red blood cell rouleaux formation present", "Red blood cell schistocytes", "Red blood cell schistocytes present", "Red blood cell sedimentation rate", "Red blood cell sedimentation rate increased", "Retinal haemorrhage", "Retinal vein occlusion", "Sensation of blood flow", "Swelling", "Syncope", "Transient ischaemic attack", "Troponin", "Troponin increased", "Troponin I", "Troponin I increased", "Troponin T increased", "Upper gastrointestinal haemorrhage", "Uterine haemorrhage", "Vaginal haemorrhage", "Vascular test", "Vasculitis", "Vasoconstriction", "Vasodilatation", "Vein discolouration", "Vein disorder", "Vein rupture", "Venogram", "Venogram abnormal", "Venous stent insertion")
#strings_circulation_2
strings_circulation <- c(strings_circulation_1,strings_circulation_2)
#strings_circulation
```
```{r}
strings_respiration <- c("Acute respiratory distress syndrome", "Acute respiratory failure", "Airway secretion clearance therapy", "Allergic respiratory symptom", "Alveolar lung disease", "Asthma", "Atelectasis", "Bilevel positive airway pressure", "Biopsy lung abnormal", "Breath sounds", "Breath sounds abnormal", "Breath sounds absent", "Bronchial hyperreactivity", "Bronchial secretion retention", "Bronchial wall thickening", "Bronchiectasis", "Bronchitis", "Bronchoscopy", "Bronchoscopy abnormal", "Bronchospasm", "Cardio-respiratory distress", "Chronic respiratory failure", "Chest X-ray abnormal", "Chronic obstructive pulmonary disease", "Continuous positive airway pressure", "Cough", "Dependence on respirator", "Dependence on oxygen therapy", "Dyspnoea", "Dyspnoea exertional", "Fraction of inspired oxygen", "Increased bronchial secretion", "Increased viscosity of upper respiratory secretion", "Interstitial lung disease", "Irregular breathing", "Laryngotracheobronchoscopy", "Lower respiratory tract congestion", "Lower respiratory tract infection", "Lung consolidation", "Lung disorder", "Lung hyperinflation", "Lung infiltration", "Lung neoplasm malignant", "Lung abscess", "Lung carcinoma cell type unspecified stage IV", "Lung consolidation", "Lung disorder", "Lung hyperinflation", "Lung infiltration", "Lung opacity", "Lung neoplasm malignant",  "Oxygen saturation abnormal", "Oxygen saturation decreased", "Oxygen therapy", "Mouth breathing", "Painful respiration", "Pleural effusion", "Pleurisy", "Pleuritic pain", "Pneumonia", "Pneumonia aspiration", "Pneumonitis", "Pneumonitis chemical", "Productive cough", "PO2 decreased", "Pulmonary congestion", "Pulmonary embolism", "Pulmonary hilar enlargement", "Pulmonary hypertension", "Pulmonary imaging procedure abnormal", "Pulmonary infarction", "Pulmonary oedema", "Pulmonary pain", "Pulmonary vascular disorder", "Rales", "Respiration abnormal", "Respiratory acidosis", "Respiratory arrest", "Respiratory depression", "Respiratory disorder", "Respiratory distress", "Respiratory failure", "Respiratory rate", "Respiratory rate decreased", "Respiratory rate increased", "Respiratory symptom", "Respiratory syncytial virus test negative", "Respiratory tract congestion", "Respiratory tract infection", "Respiratory tract oedema", "Respiratory viral panel", "Upper respiratory tract irritation", "Use of accessory respiratory muscles", "Resuscitation", "Sputum abnormal", "Sputum culture", "Upper-airway cough syndrome", "Use of accessory respiratory muscles" ,"Wheezing", "Venous oxygen partial pressure", "Venous oxygen saturation decreased")
#strings_respiration
```
```{r}
strings_cardiovascular <- c(strings_heart, strings_circulation, strings_respiration)
#strings_cardiovascular
```
```{r}
strings_neurological_1 <- c("Acoustic neuritis", "Acute disseminated encephalomyelitis", "Acute motor-sensory axonal neuropathy", "Ageusia", "Agitation", "Anti-neuronal antibody", "Aphasia", "Aphonia", "Areflexia", "Hallucination, auditory", "Autonomic nervous system imbalance", "Balance disorder", "Basal ganglia haemorrhage", "Basal ganglia stroke", "Biopsy brain", "Biopsy brain abnormal", "Brachial plexus injury", "Brain herniation", "Brain injury", "Brain midline shift", "Brain natriuretic peptide", "Brain natriuretic peptide increased", "Brain abscess", "Brain oedema", "Central nervous system inflammation", "Central nervous system lesion", "Cerebral artery occlusion", "Cerebral artery stenosis", "Cerebral atrophy", "Cerebral disorder", "Cerebral haemorrhage", "Cerebral infarction", "Cerebral microangiopathy", "Cerebral small vessel ischaemic disease", "Cerebral venous sinus thrombosis", "Cerebral ventricle dilatation", "Cerebrovascular accident", "Cervical spinal stenosis", "Coma", "Coma scale abnormal", "Computerised tomogram head abnormal", "Confabulation", "Confusional state", "Cranial nerve disorder", "Cranial nerve paralysis", "Deafness neurosensory", "Decompressive craniectomy", "Dementia", "Demyelination", "Demyelinating polyneuropathy", "Dental paraesthesia", "Depressed level of consciousness", "Depression", "Disorientation", "Dissociation", "Dissociative disorder", "Disturbance in attention", "Dysaesthesia", "Dyskinesia", "Electroencephalogram abnormal", "Encephalitis", "Euphoric mood", "Extraocular muscle paresis", "Eye paraesthesia", "Facial paralysis", "Focal dyscognitive seizures", "IVth nerve paralysis", "VIth nerve paralysis", "Gait disturbance", "Gait inability", "Gaze palsy", "Generalised tonic-clonic seizure", "Guillain-Barre syndrome", "Hallucination", "Hallucination, auditory", "Hallucination, visual", "Halo vision", "Hand-eye coordination impaired", "Head discomfort", "Headache", "Hemiparaesthesia", "Hemiparaesthesia teeth", "Herpes zoster infection neurological", "Hyperaesthesia", "Hyperaesthesia teeth", "Hypoaesthesia", "Hypoaesthesia eye", "Hypoaesthesia oral", "Incoherent", "Injected limb mobility decreased", "Injection site hypoaesthesia", "Injection site movement impairment", "Injection site muscle weakness", "Injection site nerve damage", "Injection site pain", "Intranasal hypoaesthesia", "Laryngeal tremor", "Limb immobilisation", "Lumbar puncture abnormal", "Lumbar spinal stenosis", "Magnetic resonance imaging brain", "Magnetic resonance imaging brain abnormal", "Magnetic resonance imaging spinal abnormal", "May-Thurner syndrome", "Memory impairment")
#strings_neurological_1
strings_neurological_2 <- c( "Meningioma", "Mononeuropathy", "Motion sickness", "Motor dysfunction", "Multiple sclerosis relapse", "Muscle atrophy",  "Muscle contractions involuntary", "Muscle contracture",  "Muscle disorder", "Muscle spasms", "Muscle spasticity", "Muscle twitching", "Muscular weakness", "Myalgia", "N-terminal prohormone brain natriuretic peptide increased", "Nerve block", "Nerve compression", "Nerve conduction studies abnormal", "Nerve injury", "Nervous system disorder", "Neurologic neglect syndrome", "Neurological examination", "Neurological examination abnormal", "Neurological symptom", "Neuropathy peripheral", "Optic ischaemic neuropathy", "Pain", "Paraesthesia", "Paraesthesia ear", "Paraesthesia oral", "Paralysis", "Partial seizures", "Perfusion brain scan", "Perfusion brain scan abnormal", "Peripheral motor neuropathy", "Peripheral sensorimotor neuropathy", "Peroneal nerve palsy", "Pharyngeal hypoaesthesia", "Pharyngeal paraesthesia", "Phonophobia", "Photopsia", "Polyneuropathy", "Posterior reversible encephalopathy syndrome", "Posturing", "Prohormone brain natriuretic peptide", "Psychogenic seizure", "Pulseless electrical activity", "Pupil fixed", "Scan brain", "Seizure", "Seizure cluster", "Seizure like phenomena", "Self esteem decreased", "Sensation of foreign body", "Sensitive skin", "Sensory disturbance", "Sensory loss", "Sleep apnoea syndrome", "Sleep disorder", "Slow response to stimuli", "Slow speech", "Sluggishness", "Small fibre neuropathy", "Somnolence", "Speech disorder", "Speech sound disorder", "Spinal cord lipoma", "Spinal disorder", "Spinal osteoarthritis", "Spinal nerve stimulator implantation", "Spinal operation", "Spinal pain", "Spinal retrolisthesis", "Spinal stenosis", "Spinal X-ray abnormal", "Staring", "Subarachnoid haemorrhage", "Taste disorder", "Thinking abnormal", "Tinnitus", "Tongue biting", "Tongue movement disturbance", "Tongue spasm", "Tremor", "Tunnel vision", "Unresponsive to stimuli", "Upper motor neurone lesion", "Vertigo", "Vestibular neuronitis", "Vision blurred", "Visual acuity reduced", "Visual impairment", "Visual tracking test abnormal", "White matter lesion")
#strings_neurological_2
strings_neurological <- c(strings_neurological_1, strings_neurological_2)
#strings_neurological
```
```{r}
strings_immunological_mediators <- c("Allergy test positive", "Allergy to vaccine", "Anaphylactic reaction", "Anaphylactic shock", "Anaphylactoid reaction", "Antibody test abnormal", "Antineutrophil cytoplasmic antibody", "Antineutrophil cytoplasmic antibodyincreased", "Antineutrophil cytoplasmic antibody positive", "Antinuclear antibody positive", "Antiphospholipid antibodies positive", "Autoantibody positive", "Band neutrophil count", "Band neutrophil percentage", "Band neutrophil percentage decreased", "Band neutrophil percentage increased", "Basophil count decreased", "Basophil count increased", "Basophil percentage decreased", "Basophil percentage increased", "Blood immunoglobulin A", "Blood immunoglobulin A decreased", "Blood immunoglobulin A increased", "Blood immunoglobulin E", "Blood immunoglobulin E decreased", "Blood immunoglobulin E increased", "Blood immunoglobulin G", "Blood immunoglobulin G increased", "Blood immunoglobulin M", "Blood immunoglobulin M decreased", "Blood immunoglobulin M increased", "CD4 lymphocyte percentage decreased", "CD4 lymphocytes", "C-reactive protein", "C-reactive protein decreased", "C-reactive protein increased", "Cardiolipin antibody negative", "Complement factor", "Complement factor C4", "CSF immunoglobulin G index", "CSF immunoglobulin increased", "CSF lymphocyte count abnormal", "CSF lymphocyte count increased", "CSF neutrophil count increased", "CSF white blood cell count increased", "Cytokine release syndrome", "Differential white blood cell count abnormal", "Drug hypersensitivity", "Drug reaction with eosinophilia and systemic symptoms", "Eczema", "Eosinophil count", "Eosinophil count decreased", "Eosinophil count increased", "Eosinophil percentage", "Eosinophil percentage decreased", "Eosinophil percentage increased", "Epstein-Barr virus antigen positive", "Haemophagocytic lymphohistiocytosis", "Hepatitis B antigen positive", "Hepatitis B surface antigen", "Hepatitis E antigen positive", "Histamine intolerance", "Histamine level increased", "Immature granulocyte count increased", "Immature granulocyte percentage increased", "Immune complex assay", "Immune system disorder", "Immune thrombocytopenia", "Immunisation", "Immunodeficiency", "Immunoglobulin therapy", "Immunoglobulins", "Immunology test", "Immunosuppression", "Inflammatory marker increased", "Interleukin level", "Leukocytosis", "Lip erythema", "Lymph node pain", "Lymph node palpable", "Lymphocyte count", "Lymphocyte count abnormal", "Lymphocyte count decreased", "Lymphocyte count increased", "Lymphocyte percentage decreased", "Lymphocyte percentage increased", "Monocyte count", "Monocyte count decreased", "Monocyte count increased", "Monocyte percentage decreased", "Monocyte percentage increased", "Neutrophil count", "Neutrophil count decreased", "Neutrophil count increased", "Neutrophil function test abnormal", "Neutrophil percentage decreased", "Neutrophil percentage increased", "Neutrophil toxic granulation present", "Neutrophilia", "Prostatic specific antigen increased", "Sputum abnormal", "Stress", "Systemic inflammatory response syndrome", "T-lymphocyte count", "T-lymphocyte count abnormal", "T-lymphocyte count decreased", "T-lymphocyte count increased", "Vaccine positive rechallenge", "White blood cell count", "White blood cell count abnormal", "White blood cell count decreased", "White blood cell count increased", "White blood cell morphology abnormal", "White blood cells urine positive")
#strings_immunological_mediators
```
```{r}
strings_immune_effects <- c("Abdominal lymphadenopathy", "Acute febrile neutrophilic dermatosis", "Anal erythema", "Anaphylactic reaction", "Anaphylactic shock", "Anaphylactoid reaction", "Anxiety", "Appendicitis", "Appendicitis perforated", "Arthralgia", "Arthritis", "Arthritis bacterial", "Autoimmune demyelinating disease", "Autoimmune disorder", "Autoimmune thyroiditis", "Bacterial tracheitis", "Bronchitis", "Bursitis", "Butterfly rash", "Cellulitis", "Cheilitis", "Cholecystitis", "Cholecystitis acute", "Cholecystitis chronic", "Cholecystitis infective", "Colitis", "Colitis ischaemic", "Complicated appendicitis", "Conjunctivitis", "Conjunctivitis allergic", "Cystitis", "Cytokine storm", "Dermatitis allergic", "Diabetes mellitus", "Diabetic ketoacidosis", "Diverticulitis", "Drug reaction with eosinophilia and systemic symptoms", "Encephalomyelitis", "Eosinophilia", "Erythema", "Erythema multiforme", "Erythema nodosum", "Erythema of eyelid", "Gingival erythema", "Extensive swelling of vaccinated limb", "Eye inflammation", "Fasciitis", "Febrile convulsion", "Febrile neutropenia", "Focal peritonitis", "Hilar lymphadenopathy", "Guillain-Barre syndrome", "Hepatitis", "Hepatitis acute", "Herpes simplex", "Herpes simplex encephalitis", "Herpes simplex reactivation", "Herpes virus infection", "Herpes zoster", "Herpes zoster cutaneous disseminated", "Hidradenitis", "Hyperpyrexia", "Impaired driving ability", "Impaired work ability", "Immediate post-injection reaction", "Immune thrombocytopenia", "Inflammation", "Influenza A virus test positive", "Influenza like illness", "Influenza virus test positive", "Injection site abscess", "Injection site cellulitis", "Injection site discolouration", "Injection site discomfort", "Injection site erythema", "Injection site induration", "Injection site inflammation", "Injection site irritation", "Injection site joint pain", "Injection site joint swelling", "Injection site mass", "Injection site nodule", "Injection site oedema", "Injection site paraesthesia", "Injection site pruritus", "Injection site reaction", "Injection site swelling", "Injection site erythema", "Injection site lymphadenopathy",  "Iridocyclitis", "Labyrinthitis", "Laryngitis", "Leukopenia", "Lymphadenitis", "Lymphadenopathy", "Lymphadenopathy mediastinal", "Lymphoedema", "Lymphangitis", "Lymphopenia", "Malaise", "Mastitis", "May-Thurner syndrome", "Mediastinitis", "Meningitis", "Meningitis aseptic", "Meningitis viral", "Myelitis", "Mouth ulceration", "Mucosal inflammation", "Multiple allergies", "Multipathogen PCR test", "Multiple sclerosis relapse", "Mycoplasma test positive", "Myelitis transverse", "Nasopharyngitis", "Necrosis", "Neuritis", "Neutropenia", "Neutrophilia", "Nodular rash", "Noninfective encephalitis", "Noninfective gingivitis", "Ophthalmic herpes simplex", "Optic neuritis", "Oral herpes", "Oral mucosal blistering", "Oral viral infection", "Osteoarthritis", "Palindromic rheumatism", "Pancreatitis", "Pancreatitis acute", "Panophthalmitis", "Parkinsonism", "Peptostreptococcus infection", "Periarthritis", "Pharyngitis", "Poor quality sleep", "Pneumonia viral", "Pruritus", "Pyrexia", "Radiculitis brachial", "Rash", "Rash erythematous", "Rash macular", "Rash maculo-papular", "Rash morbilliform", "Rash papular", "Rash pruritic", "Reaction to excipient", "Reaction to previous exposure to any vaccine", "Rheumatoid arthritis", "Rhinitis", "Rosacea")
#strings_immunological_effects
strings_immune_system <- c(strings_immunological_mediators, strings_immune_effects)
```
```{r}
strings_skin <- c("SARS-CoV-2 antibody test negative", "SARS-CoV-2 antibody test positive", "Scleritis", "Scrotal dermatitis", "Seasonal allergy", "Seborrhoea", "Secretion discharge", "Septic screen", "Serum sickness", "Spinal osteoarthritis", "Splenomegaly", "Sialoadenitis", "Sinusitis", "Splenic granuloma", "Staphylococcal bacteraemia", "Staphylococcal infection", "Staphylococcus test positive", "Status asthmaticus", "Stevens-Johnson syndrome", "Stomatitis", "Streptococcus test positive", "Synovitis", "Systemic lupus erythematosus", "Systemic lupus erythematosus rash", "Systemic scleroderma", "Tendonitis", "Tenosynovitis", "Thrombophlebitis", "Tongue erythema", "Tonsillitis", "Tracheitis", "Type III immune complex mediated reaction", "Ulnar neuritis", "Urosepsis", "Urticaria", "Uveitis", "Vaccination complication", "Vaccination site cellulitis", "Vaccination site erythema", "Vaginal ulceration", "Varicella zoster virus infection", "Vestibular neuronitis", "Viral cardiomyopathy", "Viral infection", "Viral pericarditis", "Viral rash", "Viral test positive", "Viral titre", "Vulvovaginal rash", "Acne", "Acute febrile neutrophilic dermatosis", "Biopsy skin", "Biopsy skin abnormal", "Blister", "Bullous haemorrhagic dermatosis", "Butterfly rash", "Cellulitis", "Chapped lips", "Contusion", "Dermatitis", "Dermatitis bullous", "Dermatitis contact", "Dermatitis exfoliative generalised", "Dry skin", "Exposure via skin contact", "Epidermal necrosis", "Eyelid rash", "Fungal infection", "Genital ulceration", "Hand dermatitis", "Haemorrhage subepidermal", "Herpes simplex", "Herpes simplex reactivation", "Herpes virus infection", "Herpes zoster", "Herpes zoster cutaneous disseminated", "Genital rash", "Increased tendency to bruise", "Injection site dryness", "Injection site hypersensitivity", "Injection site plaque", "Injection site rash", "Injection site scab", "Injection site urticaria", "Ischaemic skin ulcer", "Keratitis", "Lip blister", "Mouth ulceration", "Nail bed disorder", "Necrotising fasciitis", "Nipple pain", "Oedema mouth", "Oral contusion", "Oral herpes", "Oral mucosal blistering", "Oral viral infection", "Pain of skin", "Penile rash", "Petechiae", "Pruritus", "Psoriatic arthropathy", "Purpura", "Pustule", "Rash", "Rash erythematous", "Rash macular", "Rash maculo-papular", "Rash morbilliform", "Rash papular", "Rash pruritic", "Rash pustular", "Rash vesicular", "Rosacea", "Scab", "Scar", "Scratch", "Scrotal dermatitis", "Seborrhoea", "Sensitive skin", "Skin bacterial infection", "Skin burning sensation", "Skin culture", "Skin discolouration", "Skin discomfort", "Skin disorder", "Skin exfoliation", "Skin haemorrhage", "Skin hyperpigmentation", "Skin induration", "Skin irritation", "Skin odour abnormal", "Skin laceration", "Skin lesion", "Skin mass", "Skin plaque", "Skin reaction", "Skin sensitisation", "Skin swelling", "Skin tightness", "Skin test", "Skin test positive", "Skin tightness", "Skin ulcer", "Skin warm", "Systemic lupus erythematosus rash", "Systemic scleroderma", "Toxic epidermal necrolysis", "Ulcer", "Urticaria", "Vaccination site bruising", "Vaccination site irritation", "Vaccination site rash", "Viral rash", "Vulvovaginal rash", "Yellow skin")
#strings_skin
strings_temperature <- c("Body temperature", "Body temperature abnormal", "Body temperature decreased", "Body temperature increased", "Chills", "Cold sweat", "Exposure to extreme temperature", "Febrile neutropenia", "Feeling cold", "Feeling hot", "Feeling of body temperature change", "Flushing", "Hot flush", "Hyperpyrexia", "Hypothermia", "Injection site coldness", "Injection site warmth", "Night sweats", "Peripheral coldness", "Pyrexia", "Skin warm", "Temperature intolerance")
#strings_temperature
strings_immunological <- c(strings_immune_effects, strings_skin, strings_temperature)
#strings_immunological
```
```{r}
CARDIOVASCULAR_human <- function(SYMPTOM) {
  if(str_detect(SYMPTOM, paste(strings_cardiovascular, collapse = "|"))) {
   CV_human = "CARDIOVASCULAR"
    }
      else {
        CV_human = "NA"
    }
  return(CV_human)
}
NEUROLOGICAL_human <- function(SYMPTOM) {
  if(str_detect(SYMPTOM, paste(strings_neurological, collapse = "|"))) {
   NEURO_human = "NEUROLOGICAL"
    }
      else {
        NEURO_human = "NA"
    }
  return(NEURO_human)
}
IMMUNOLOGICAL_human <- function(SYMPTOM) {
  if(str_detect(SYMPTOM, paste(strings_immunological, collapse = "|"))) {
   IMMUNO_human = "IMMUNOLOGICAL"
    }
      else {
        IMMUNO_human = "NA"
    }
  return(IMMUNO_human)
}
```
```{r}
CV <- MERGED_SYM_DAT_VAX_05_21_21_151700kb %>% rowwise() %>% filter(SYMPTOM != "NA") %>% mutate("CARDIOVASCULAR" = CARDIOVASCULAR_human(SYMPTOM)) %>% filter(CARDIOVASCULAR !="NA")
NEURO <- MERGED_SYM_DAT_VAX_05_21_21_151700kb %>% rowwise() %>% filter(SYMPTOM != "NA") %>% mutate("NEUROLOGICAL" = NEUROLOGICAL_human(SYMPTOM)) %>% filter(NEUROLOGICAL !="NA")
IMMUNO <- MERGED_SYM_DAT_VAX_05_21_21_151700kb %>% rowwise() %>% filter(SYMPTOM != "NA") %>% mutate("IMMUNOLOGICAL" = IMMUNOLOGICAL_human(SYMPTOM)) %>% filter(IMMUNOLOGICAL !="NA")

#nrow(CV)
#nrow(NEURO)
#nrow(IMMUNO)
```
```{r}
strings_covid <- c("COVID-19", "Suspected COVID-19", "SARS-CoV-2 test positive", "COVID-19 pneumonia", "Asymptomatic COVID-19")
COVID_CASES <- function(SYMPTOM) {
  if(str_detect(SYMPTOM, paste(strings_covid, collapse = "|"))) {
      COVID19 = "COVID_CASE"
      } 
        else {
          COVID19 = "NA"
      }
    return(COVID19)
}
MERGED_SYM_DAT_VAX_05_21_21_151700kb_covid_cases <- MERGED_SYM_DAT_VAX_05_21_21_151700kb %>% rowwise() %>% filter(SYMPTOM != "NA") %>% mutate("COVID_CASES" = COVID_CASES(SYMPTOM)) %>% filter(COVID_CASES != "NA")
MERGED_SYM_DAT_VAX_05_21_21_151700kb_covid_cases <- replace(MERGED_SYM_DAT_VAX_05_21_21_151700kb_covid_cases, "SYMPTOM", "COVID19") 
#nrow(MERGED_SYM_DAT_VAX_05_21_21_151700kb_covid_cases)
MERGED_SYM_DAT_VAX_05_21_21_151700kb_covid_cases_dead <- MERGED_SYM_DAT_VAX_05_21_21_151700kb_covid_cases %>% filter(DIED == "Y") 
#nrow(MERGED_SYM_DAT_VAX_05_21_21_151700kb_covid_cases_dead)
Perc_D_BC = (nrow(MERGED_SYM_DAT_VAX_05_21_21_151700kb_covid_cases_dead)/nrow(MERGED_SYM_DAT_VAX_05_21_21_151700kb_covid_cases)*100)
#Perc_D_BC
```
```{r}
AGE_GROUPED_BY_DECADE <- function(AGE_YRS) {
  if(AGE_YRS >= 0 & AGE_YRS <10) {
    AGE_GROUP = "A. 0-10"
    } else if(AGE_YRS >= 10 & AGE_YRS <20) {
      AGE_GROUP = "B. 10-20"
      } else if(AGE_YRS >= 20 & AGE_YRS <30) {
        AGE_GROUP = "C. 20-30"
        } else if(AGE_YRS >= 30 & AGE_YRS <40) {
          AGE_GROUP = "D. 30-40"
          } else if(AGE_YRS >= 40 & AGE_YRS <50) {
            AGE_GROUP = "E. 40-50"
            } else if(AGE_YRS >= 50 & AGE_YRS <60) {
              AGE_GROUP = "F. 50-60"
              } else if(AGE_YRS >= 60 & AGE_YRS <70) {
                AGE_GROUP = "G. 60-70"
                } else if(AGE_YRS >= 70 & AGE_YRS <80) {
                  AGE_GROUP = "H. 70-80"
                  } else if(AGE_YRS >= 80 & AGE_YRS <90) {
                    AGE_GROUP = "I. 80-90"
                    } else if(AGE_YRS >= 90 & AGE_YRS <100) {
                      AGE_GROUP = "J. 90-100"
                      } else if(AGE_YRS >= 100 & AGE_YRS <110) {
                        AGE_GROUP = "K. 100-110"
                        }
  else {
    AGE_GROUP = "NA"
    }
  return(AGE_GROUP)
}
```
DISTRIBUTION OF ALL DATA BY AGE GROUP - THE MAJORITY OF INDIVIDUALS ARE BETWEEN THE AGES OF 30 AND 70
```{r}
#png("MERGED_SYM_DAT_VAX_05_21_21_151700kb_count_plot.png", width = 4, height = 4, units = 'in', res = 100)

MERGED_SYM_DAT_VAX_05_21_21_151700kb_AG <- MERGED_SYM_DAT_VAX_05_21_21_151700kb %>% rowwise() %>% filter(AGE_YRS != "NA") %>% mutate("AGE_GROUP" = AGE_GROUPED_BY_DECADE(AGE_YRS))
MERGED_SYM_DAT_VAX_05_21_21_151700kb_AG_count <- MERGED_SYM_DAT_VAX_05_21_21_151700kb_AG %>% count(AGE_GROUP)
MERGED_SYM_DAT_VAX_05_21_21_151700kb_count_plot <- ggplot(MERGED_SYM_DAT_VAX_05_21_21_151700kb_AG_count, aes(AGE_GROUP, n, fill = AGE_GROUP)) + geom_bar(stat = "Identity") + geom_text(aes(label = n)) + xlab("AGE GROUPS") + ylab("ADVERSE EVENTS (N)") + theme(axis.text.y = element_text(colour = "black", size = 12)) + theme(axis.text.x = element_text(colour = "black", angle=25,vjust=0.5,hjust=0.5, size = 8)) + theme(legend.position = "none") + ggtitle("ALL AEs -> Distribution of AGE GROUPS")
MERGED_SYM_DAT_VAX_05_21_21_151700kb_count_plot

MERGED_SYM_DAT_VAX_05_21_21_151700kb_AGE_count <- MERGED_SYM_DAT_VAX_05_21_21_151700kb %>% group_by(AGE_YRS) %>% filter(AGE_YRS != "NA") %>% count(AGE_YRS)
MERGED_SYM_DAT_VAX_05_21_21_151700kb_AGE_count <- data.frame(MERGED_SYM_DAT_VAX_05_21_21_151700kb_AGE_count, stringsAsFactors = FALSE) %>% mutate("skew" = 3*(mean(n)-median(n))/(sd(n)))
#MERGED_SYM_DAT_VAX_05_21_21_151700kb_AGE_count
```
NUMBER OF SPONTANEOUS ABORTIONS
```{r}
MERGED_SYM_DAT_VAX_05_21_21_151700kb_no_dups_SA <- MERGED_SYM_DAT_VAX_05_21_21_151700kb %>% group_by(SYMPTOM) %>% filter(SYMPTOM == "Abortion spontaneous")
nrow(MERGED_SYM_DAT_VAX_05_21_21_151700kb_no_dups_SA)
```
DISTRIBUTION OF SPONTANEOUS ABORTIONS - THIS SUBSET IS GROWING WEEKLY
```{r}
#png("MERGED_SYM_DAT_VAX_05_21_21_151700kb_SA_ID_plot", width = 4, height = 4, units = 'in', res = 100)

MERGED_SYM_DAT_VAX_05_21_21_151700kb_SA <- MERGED_SYM_DAT_VAX_05_21_21_151700kb %>% group_by(SYMPTOM) %>% filter(SYMPTOM == "Abortion spontaneous")
MERGED_SYM_DAT_VAX_05_21_21_151700kb_SA_ID <- MERGED_SYM_DAT_VAX_05_21_21_151700kb_SA %>% group_by(AGE_YRS) %>% filter(AGE_YRS != "NA") %>% count(AGE_YRS)
MERGED_SYM_DAT_VAX_05_21_21_151700kb_SA_ID_plot <- ggplot(MERGED_SYM_DAT_VAX_05_21_21_151700kb_SA_ID, aes(AGE_YRS, n, fill = AGE_YRS)) + geom_bar(stat = "Identity") + geom_text(aes(label = n)) + xlab("AGE YEARS") + ylab("NUMBER OF SPONTANEOUS ABORTIONS") + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 14))  + theme(legend.position = "none") + ggtitle("SPONTANEOUS ABORTION -> VAERS IDs vs AGE YEARS")
MERGED_SYM_DAT_VAX_05_21_21_151700kb_SA_ID_plot
```
```{r}
SA <- data.frame(MERGED_SYM_DAT_VAX_05_21_21_151700kb_SA, stringsAsFactors = FALSE) %>% filter(year(ONSET_DATE) <= 2021 & year(ONSET_DATE) >= 2020) 
MERGED_SYM_DAT_VAX_05_21_21_151700kb_SA_VD_OD <- SA %>% mutate("diff_in_days" = difftime(ONSET_DATE, VAX_DATE, units = "days")) %>% filter(diff_in_days >= 0 & diff_in_days <=50) %>% count(diff_in_days) %>% arrange(desc(n)) %>% mutate("OBSERVED" = n) %>% mutate("Percentage_OBSERVED" = n/sum(n)*100) %>% mutate("EXPECTED" = as.integer(mean(n))) %>% mutate("Percentage_EXPECTED" = EXPECTED/nrow(SA)*100)
#head(MERGED_SYM_DAT_VAX_05_21_21_151700kb_SA_VD_OD)

#chisq.test(MERGED_SYM_DAT_VAX_05_21_21_151700kb_SA_VD_OD$OBSERVED)
```
THE PLOTS SHOWING OBSERVED VERSUS EXPECTED TRAJECTORIES SHOW CLUSTERING OF DATA AROUND '0' - A LARGER PROPORTION OF REPORTS WERE MADE WITHIN 24 HOURS THAT ONE WOULD EXPECT TO SEE IF THERE WAS NO CAUSALITY

Plot showing OBSERVED (orange) vs. EXPECTED (yellow) percentages of specific time-frames between Vaccination Date and Miscarriage Date
```{r}
#png("CAUSATION_SA_plot", width = 4, height = 4, units = 'in', res = 100)

CAUSATION_SA_plot <- ggplot() + geom_line(data = MERGED_SYM_DAT_VAX_05_21_21_151700kb_SA_VD_OD, aes(diff_in_days, Percentage_OBSERVED), colour = "orange", size = 2) + ylab("PERCENTAGE REPORTED SA AEs") + xlab("NUMBER OF DAYS FOLLOWING INJECTION") + geom_line(data = MERGED_SYM_DAT_VAX_05_21_21_151700kb_SA_VD_OD, aes(diff_in_days, Percentage_EXPECTED), colour = "yellow", size = 2) + labs(title = "SPONTANEOUS ABORTIONS post injection", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 12)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 12)) + theme(panel.background = element_rect(fill = "#100000")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) 
CAUSATION_SA_plot
```
HEATMAPS ARE BEAUTIFUL WAYS TO ILLUSTRATE A LOT OF INFORMATION IN A SINGLE FIGURE. THESE HEATMAPS SHOW THE INTERSECTIONS OF INJECTION DATES AND ONSET OF ADVERSE EVENT DATES AS PER SPECIFIC AE GROUP. THE COLOR OF THE INTERSECTION 'BLOCK' INDICATES THE NUMBER OF INTERSECTIONS THAT OCCURRED - RED = HIGHEST; BLUE = LOWEST. POINTS LYING ON THE DIAGONAL HAVE A CORRELATION COEFFICIENT WHERE R = 1, INDICATING A 1:1 CORRELATION. 

HEATMAP showing correlation between Vaccine Date and Onset Date for Spontaneous Abortions
```{r}
SA_VD_OD_TILE_count <- MERGED_SYM_DAT_VAX_05_21_21_151700kb_SA %>% group_by(ONSET_DATE, VAX_DATE) %>% filter(year(ONSET_DATE) <= 2021 & year(ONSET_DATE) >= 2021) %>% filter(year(VAX_DATE) <= 2021 & year(VAX_DATE) >= 2021)%>% mutate("diff_in_days" = difftime(ONSET_DATE, VAX_DATE, units = "days")) %>% filter(diff_in_days >= 0 & diff_in_days <=50) %>% count(diff_in_days) 

#png("SA_VD_OD_TILE_count_plot ", width = 4, height = 4, units = 'in', res = 100)

SA_VD_OD_TILE_count_plot <- ggplot(SA_VD_OD_TILE_count, aes(VAX_DATE, ONSET_DATE)) + geom_tile(aes(fill = n)) + scale_fill_gradient('n', low = "blue", high = "red") + theme(panel.background = element_rect(fill = "black", color = 'black')) + ylab("ONSET OF SPONTANEOUS ABORTION") + xlab("VACCINE DATE") + theme(panel.grid=element_blank()) + theme(axis.text.x = element_text(colour = "black", size = 14)) + theme(axis.text.y = element_text(colour = "black", size = 14), axis.text.x=element_text(angle=0,vjust=0.5,hjust=0.5)) + ggtitle("VACCINE DATE vs SA DATE") 
SA_VD_OD_TILE_count_plot
```
Distribution of all Breakthrough COVID-19 cases by age group
```{r}
#png("AGE_GROUPS_COVID_plot", width = 4, height = 4, units = 'in', res = 100)
AGE_GROUPS_COVID <- MERGED_SYM_DAT_VAX_05_21_21_151700kb_covid_cases %>% rowwise() %>% filter(AGE_YRS != "NA") %>% mutate("AGE_GROUP" = AGE_GROUPED_BY_DECADE(AGE_YRS))
AGE_GROUPS_COVID_count <- AGE_GROUPS_COVID %>% group_by(AGE_GROUP) %>% filter(AGE_GROUP != "NA") %>% count(AGE_GROUP)
AGE_GROUPS_COVID_plot <- ggplot(AGE_GROUPS_COVID_count, aes(AGE_GROUP, n, fill = AGE_GROUP)) + geom_bar(stat = "Identity") + geom_text(aes(label = n)) + xlab("AGE GROUPS") + ylab("NUMBER OF COVID-19 BREAKTHROUGH INFECTIONS") + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=25,vjust=0.5,hjust=0.5, size = 8)) + theme(legend.position = "none") + ggtitle("Breakthough Covid-19 Infections -> VAERS IDs vs AGE GROUPS")
AGE_GROUPS_COVID_plot

AGE_GROUPS_COVID_plot_skew <- data.frame(AGE_GROUPS_COVID_count, stringsAsFactors = FALSE) %>% mutate("skew" = 3*(mean(n)-median(n))/(sd(n)))
#AGE_GROUPS_COVID_plot_skew
```
CUMULATIVE BREAKTHROUGH COVID-19 CASES
```{r}
Table_IDs_COVID_percent <- data.frame(
  DATE = as.Date(c("1/16/21", "1/23/21", "1/30/21", "2/13/21", "2/27/21", "3/5/21", "3/12/21", "3/19/21", "3/26/21", "4/2/21", "4/9/21", "4/16/21", "4/23/21", "4/30/21", "5/7/21", "5/12/21", "5/19/21"), "%m/%d/%y"),
  COVID = as.numeric(c("194", "254", "326", "619", "717", "776", "943", "1057", "1169", "1267", "1375", "1404", "1587", "1930", "2776", "3317", "3742")),
  
  stringsAsFactors = FALSE
)
#head(Table_IDs_COVID_percent)

#png("Table_IDs_COVID_plot.png", width = 4, height = 4, units = 'in', res = 100)

Table_IDs_COVID_plot <- ggplot(data = Table_IDs_COVID_percent, aes(x = DATE, y = COVID)) + geom_line(data = Table_IDs_COVID_percent, aes(x = DATE, y = COVID, colour = "COVID"), colour = "red", size = 2) + geom_point(data = Table_IDs_COVID_percent, aes(DATE, COVID, colour = "COVID"), colour = "red", size = 5) + xlab("DATE") +  ylab("NUMBER OF BREAKTHROUGH INFECTIONS") + labs(title = "ABSOLUTE NUMBER OF BREAKTHROUGH INFECTIONS (CUMULATIVE)", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=15,vjust=0.5,hjust=0.5, size = 10)) + theme(panel.background = element_rect(fill = "black")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + theme(legend.title=element_blank()) + scale_x_continuous(breaks = round(seq(min(Table_IDs_COVID_percent$DATE), max(Table_IDs_COVID_percent$DATE), by = 10),0.1))
Table_IDs_COVID_plot
```
```{r}
BCC_count <- MERGED_SYM_DAT_VAX_05_21_21_151700kb_covid_cases %>% group_by(SYMPTOM, VAX_MANU) %>% count(SYMPTOM)
BCC_count_plot <- ggplot(BCC_count, aes(VAX_MANU, n, fill = VAX_MANU)) + geom_bar(stat = "Identity") + geom_text(aes(label = n)) + xlab("ID COUNT (N)") + ylab("COVID DIAGNOSIS") + theme(axis.text.y = element_text(colour = "#000000", size = 12)) + theme(axis.text.x = element_text(angle=0,vjust=0.5,hjust=0.5, size = 10)) + ggtitle("COVID CASES AS PER MANUFACTURER") + theme(legend.position = "none")
```
BREAKTHROUGH COVID CASES BY MANUFACTURER
```{r}
no_COVID_sym <- MERGED_SYM_DAT_VAX_05_21_21_151700kb %>% filter(SYMPTOM != "COVID19")
no_BCC_count_VM <- no_COVID_sym %>% group_by(VAX_MANU) %>% count(VAX_MANU) %>% filter(VAX_MANU != "NA" & VAX_MANU != "UNKNOWN MANUFACTURER") %>% mutate("PERC" = n/(nrow(MERGED_SYM_DAT_VAX_05_21_21_151700kb))*100) %>% mutate("Round" = round(PERC, 2))
#no_BCC_count_VM
BCC_count_VM <- MERGED_SYM_DAT_VAX_05_21_21_151700kb_covid_cases %>% group_by(VAX_MANU) %>% count(VAX_MANU) %>% filter(VAX_MANU != "NA" & VAX_MANU != "UNKNOWN MANUFACTURER") %>% mutate("PERC" = n/(nrow(MERGED_SYM_DAT_VAX_05_21_21_151700kb_covid_cases))*100) %>% mutate("Round" = round(PERC, 2))
BCC_count_VM <- data.frame(BCC_count_VM, stringsAsFactors = FALSE) 
#BCC_count_VM
```
```{r}
pie_VM <- plot_ly(BCC_count_VM, labels = ~VAX_MANU, values = ~Round, type = 'pie')
pie_VM <- pie_VM %>% layout(title = 'BREAKTHROUGH COVID-19 CASES BY MANUFACTURER',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))
pie_VM
```
THE QUESTION OF DISTRIBUTION BY MANUFACTURER SHOULD BE ANSWERED IN ORDER TO ASSESS WHETHER OR NOT PFIZER IS ACTUALLY MORE HIGHLY ASSOCIATED WITH BREAKTHROUGH INFECTIONS - THE PRODUCTS ARE EQUALLY DISTRIBUTED THROUGHOUT THE U.S. POPULATION SO IT APPEARS AS THOUGH PFIZER IS MORE HIGHLY ASSOCIATED WITH BREAKTHROUGH INFECTIONS

Pie chart for distribution of vax manu data in US population (U.S. COVID-19 Vaccine Delivered by Vaccine Type					
Date generated: CDC | Data as of: May 4, 2021 6:00am ET. Posted: Tuesday, May 25, 2021 6:00 PM ET https://covid.cdc.gov/covid-data-tracker/#vaccinations 
```{r}
Table_DIST_VM_US <- data.frame(
  VAX_MANU = c("PFIZER/BIONTECH", "MODERNA", "JANSSEN"),
  FVP = as.integer(c(67434538, 52916100, 10210450)),
 
  stringsAsFactors = FALSE
)
Table_DIST_VM_US_percent <- data.frame(Table_DIST_VM_US, stringsAsFactors = FALSE) %>% mutate("TOTAL_PMJ" = as.numeric(round(sum(FVP)))) %>% mutate("Percentage_PMJ" = as.numeric(FVP/(TOTAL_PMJ)*100)) %>% mutate("Round" = round(Percentage_PMJ, 2))
#Table_DIST_VM_US_percent
```
```{r}
pie_Table_DIST_VM_US_percent <- plot_ly(Table_DIST_VM_US_percent, labels = ~VAX_MANU, values = ~Round, type = 'pie')
pie_Table_DIST_VM_US_percent <- pie_Table_DIST_VM_US_percent %>% layout(title = 'FULLY-VAXXED U.S. POPULATION BY MANUFACTURER',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))
pie_Table_DIST_VM_US_percent 
```
BREAKTHROUGH COVID-19 CASES WHO DIED
```{r}
BCC_count_VM_dead <- MERGED_SYM_DAT_VAX_05_21_21_151700kb_covid_cases %>% group_by(VAX_MANU, DIED) %>% count(DIED) %>% filter(VAX_MANU != "NA" & VAX_MANU != "UNKNOWN MANUFACTURER" & DIED == "Y") %>% mutate("PERC" = n/(nrow(MERGED_SYM_DAT_VAX_05_21_21_151700kb_covid_cases))*100) %>% mutate("Round" = round(PERC, 2))
BCC_count_VM_dead <- data.frame(BCC_count_VM_dead, stringsAsFactors = FALSE) 
#BCC_count_VM_dead
```
```{r}
pie_VM_dead <- plot_ly(BCC_count_VM_dead, labels = ~VAX_MANU, values = ~Round, type = 'pie')
pie_VM_dead <- pie_VM_dead %>% layout(title = 'BREAKTHROUGH COVID-19 CASES resulting in death BY MANUFACTURER',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))
pie_VM_dead
```
BUT THANKFULLY, DEATH IS NOT EVENLY DISTRIBUTED BETWEEN MANUFACTURERS
```{r}
AGE_GROUPS_COVID <- MERGED_SYM_DAT_VAX_05_21_21_151700kb_covid_cases %>% rowwise() %>% filter(AGE_YRS != "NA") %>% mutate("AGE_GROUP" = AGE_GROUPED_BY_DECADE(AGE_YRS))
AGE_GROUPS_COVID_dead <- data.frame(AGE_GROUPS_COVID, stringsAsFactors = FALSE) %>% group_by(AGE_GROUP, DIED) %>% filter(DIED == "Y") %>% count(DIED) %>% mutate("SUM" = as.numeric(sum(n))) %>% mutate("Perc_D_tot" = as.numeric(n/(nrow(AGE_GROUPS_COVID))*100)) %>% mutate("Round" = round(Perc_D_tot, 2))
#AGE_GROUPS_COVID_dead
```
BREAKTHROUGH COVID-19 CASES WHO DIED BY AGE
```{r}
pie_AGE_GROUPS_COVID_dead <- plot_ly(AGE_GROUPS_COVID_dead, labels = ~AGE_GROUP, values = ~Round, type = 'pie')
pie_AGE_GROUPS_COVID_dead <- pie_AGE_GROUPS_COVID_dead %>% layout(title = 'BREAKTHROUGH COVID-19 CASES RESULTING IN DEATH BY AGE GROUP',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))
pie_AGE_GROUPS_COVID_dead
```
```{r}
D <- MERGED_SYM_DAT_VAX_05_21_21_151700kb %>% filter(DIED == "Y") %>% filter(year(DATEDIED) <= 2021 & year(DATEDIED) >= 2020) 
MERGED_SYM_DAT_VAX_05_21_21_151700kb_VD_DD <- D %>% mutate("diff_in_days" = difftime(DATEDIED, VAX_DATE, units = "days")) %>% filter(diff_in_days >= 0 & diff_in_days <=50) %>% count(diff_in_days) %>% arrange(desc(n)) %>% mutate("OBSERVED" = n) %>% mutate("Percentage_OBSERVED" = n/sum(n)*100) %>% mutate("EXPECTED" = as.integer(mean(n))) %>% mutate("Percentage_EXPECTED" = EXPECTED/nrow(D)*100)
#head(MERGED_SYM_DAT_VAX_05_21_21_151700kb_VD_DD)

#chisq.test(MERGED_SYM_DAT_VAX_05_21_21_151700kb_VD_DD$OBSERVED)
```
Plot showing OBSERVED (orange) vs. EXPECTED (yellow) percentages of specific time-frames between Vaccination Date and Death Date
```{r}
#png("CAUSATION_DEATH_plot", width = 4, height = 4, units = 'in', res = 100)

CAUSATION_DEATH_plot <- ggplot() + geom_line(data = MERGED_SYM_DAT_VAX_05_21_21_151700kb_VD_DD, aes(diff_in_days, Percentage_OBSERVED), colour = "orange", size = 2) + ylab("PERCENTAGE OF REPORTED DEATHS") + xlab("NUMBER OF DAYS FOLLOWING INJECTION") + geom_line(data = MERGED_SYM_DAT_VAX_05_21_21_151700kb_VD_DD, aes(diff_in_days, Percentage_EXPECTED), colour = "yellow", size = 2) + labs(title = "DEATHS post injection", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 12)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 12)) + theme(panel.background = element_rect(fill = "#100000", color = "pink")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + ylim(0,15)
CAUSATION_DEATH_plot
```
HEATMAP showing correlation between Vaccine Date and Onset Date for Deaths
```{r}
VD_DD_TILE_count <- MERGED_SYM_DAT_VAX_05_21_21_151700kb %>% group_by(DIED, DATEDIED, VAX_DATE) %>% filter(DIED == "Y") %>% filter(year(DATEDIED) <= 2021 & year(DATEDIED) >= 2021) %>% filter(year(VAX_DATE) <= 2021 & year(VAX_DATE) >= 2021)%>% mutate("diff_in_days" = difftime(DATEDIED, VAX_DATE, units = "days")) %>% filter(diff_in_days >= 0 & diff_in_days <=50) %>% count(diff_in_days) 

#png("VD_DD_TILE_plot ", width = 4, height = 4, units = 'in', res = 100)

VD_DD_TILE_plot <- ggplot(VD_DD_TILE_count, aes(VAX_DATE, DATEDIED)) + geom_tile(aes(fill = n)) + scale_fill_gradient('n', low = "blue", high = "red") + theme(panel.background = element_rect(fill = "black", color = 'black')) + ylab("DATE OF DEATH") + xlab("VACCINE DATE") + theme(panel.grid=element_blank()) + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 14)) + ggtitle("VACCINE DATE vs DEATH DATE OF AEs") 
VD_DD_TILE_plot
```
Plot showing OBSERVED (orange) vs. EXPECTED (yellow) percentages of specific time-frames between Vaccination Date and Onset Date of Cardiovascular Adverse Event
```{r}
CV_new <- data.frame(CV, stringsAsFactors = FALSE) %>% filter(year(ONSET_DATE) <= 2021 & year(ONSET_DATE) >= 2020) 
MERGED_SYM_DAT_VAX_05_21_21_151700kb_CV_VD_OD <- CV_new %>% mutate("diff_in_days" = difftime(ONSET_DATE, VAX_DATE, units = "days")) %>% filter(diff_in_days >= 0 & diff_in_days <=50) %>% count(diff_in_days) %>% arrange(desc(n))  %>% mutate("OBSERVED" = n) %>% mutate("Percentage_OBSERVED" = n/sum(n)*100) %>% mutate("EXPECTED" = mean(n)) %>% mutate("EXPECTED" = mean(n)) %>% mutate("Percentage_EXPECTED" = EXPECTED/nrow(CV_new)*100)
#head(MERGED_SYM_DAT_VAX_05_21_21_151700kb_CV_VD_OD)

#chisq.test(MERGED_SYM_DAT_VAX_05_21_21_151700kb_CV_VD_OD$OBSERVED)
```
```{r}
#png("CAUSATION_CV_plot", width = 4, height = 4, units = 'in', res = 100)

CAUSATION_CV_plot <- ggplot() + geom_line(data = MERGED_SYM_DAT_VAX_05_21_21_151700kb_CV_VD_OD, aes(diff_in_days, Percentage_OBSERVED), colour = "orange", size = 2) + xlab("NUMBER OF DAYS FOLLOWING INJECTION") +  ylab("PERCENTAGE OF REPORTED CV AEs") + geom_line(data = MERGED_SYM_DAT_VAX_05_21_21_151700kb_CV_VD_OD, aes(diff_in_days, Percentage_EXPECTED), colour = "yellow", size = 2) + labs(title = "CARDIOVASCULAR AEs post injection", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 14)) + theme(panel.background = element_rect(fill = "#100000", color = "pink")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + ylim(0,60)
CAUSATION_CV_plot
```
HEATMAP showing correlation between Vaccine Date and Onset Date for Cardiovascular Adverse Events
```{r}
CV_VD_OD_TILE_count <- CV_new %>% group_by(CARDIOVASCULAR, ONSET_DATE, VAX_DATE) %>% filter(year(ONSET_DATE) <= 2021 & year(ONSET_DATE) >= 2021) %>% filter(year(VAX_DATE) <= 2021 & year(VAX_DATE) >= 2021)%>% mutate("diff_in_days" = difftime(ONSET_DATE, VAX_DATE, units = "days")) %>% filter(diff_in_days >= 0 & diff_in_days <=50) %>% count(diff_in_days) 

#png("CV_VD_DD_TILE_plot ", width = 4, height = 4, units = 'in', res = 100)

CV_VD_DD_TILE_plot <- ggplot(CV_VD_OD_TILE_count, aes(VAX_DATE, ONSET_DATE)) + geom_tile(aes(fill = n)) + scale_fill_gradient('n', low = "blue", high = "red") + theme(panel.background = element_rect(fill = "black", color = 'black')) + ylab("ONSET OF AEs") + xlab("VACCINE DATE") + theme(panel.grid=element_blank()) + theme(axis.text.x = element_text(colour = "#000000", size = 14)) + theme(axis.text.y = element_text(colour = "#000000", size = 14), axis.text.x=element_text(angle=0,vjust=0.5,hjust=0.5)) + ggtitle("VACCINE DATE vs CARDIOVASCULAR AE ONSET DATE") 
CV_VD_DD_TILE_plot
```
Plot showing OBSERVED (orange) vs. EXPECTED (yellow) percentages of specific time-frames between Vaccination Date and Onset Date of Neurological Adverse Event
```{r}
NEURO_new <- data.frame(NEURO, stringsAsFactors = FALSE) %>% filter(year(ONSET_DATE) <= 2021 & year(ONSET_DATE) >= 2020) 
MERGED_SYM_DAT_VAX_05_21_21_151700kb_NEURO_VD_OD <- NEURO_new %>% mutate("diff_in_days" = difftime(ONSET_DATE, VAX_DATE, units = "days")) %>% filter(diff_in_days >= 0 & diff_in_days <=50) %>% count(diff_in_days) %>% arrange(desc(n))  %>% mutate("OBSERVED" = n) %>% mutate("Percentage_OBSERVED" = n/nrow(NEURO_new)*100) %>% mutate("EXPECTED" = mean(n)) %>% mutate("EXPECTED" = mean(n)) %>% mutate("Percentage_EXPECTED" = EXPECTED/nrow(NEURO_new)*100)
#head(MERGED_SYM_DAT_VAX_05_21_21_151700kb_NEURO_VD_OD)

#chisq.test(MERGED_SYM_DAT_VAX_05_21_21_151700kb_NEURO_VD_OD$OBSERVED)
```
```{r}
#png("CAUSATION_NEURO_plot", width = 4, height = 4, units = 'in', res = 100)

CAUSATION_NEURO_plot <- ggplot() + geom_line(data = MERGED_SYM_DAT_VAX_05_21_21_151700kb_NEURO_VD_OD, aes(diff_in_days, Percentage_OBSERVED), colour = "orange", size = 2) + xlab("NUMBER OF DAYS FOLLOWING INJECTION") +  ylab("PERCENTAGE OF REPORTED NEURO AEs") + geom_line(data = MERGED_SYM_DAT_VAX_05_21_21_151700kb_NEURO_VD_OD, aes(diff_in_days, Percentage_EXPECTED), colour = "yellow", size = 2) + labs(title = "NEUROLOGICAL AEs post injection", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 14)) + theme(panel.background = element_rect(fill = "#100000", color = "pink")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + ylim(0,50)
CAUSATION_NEURO_plot
```
HEATMAP showing correlation between Vaccine Date and Onset Date for Neurological Adverse Events
```{r}
NEURO_VD_OD_TILE_count <- NEURO_new %>% group_by(NEUROLOGICAL, ONSET_DATE, VAX_DATE) %>% filter(year(ONSET_DATE) <= 2021 & year(ONSET_DATE) >= 2021) %>% filter(year(VAX_DATE) <= 2021 & year(VAX_DATE) >= 2021)%>% mutate("diff_in_days" = difftime(ONSET_DATE, VAX_DATE, units = "days")) %>% filter(diff_in_days >= 0 & diff_in_days <=50) %>% count(diff_in_days) 

#png("NEURO_VD_DD_TILE_plot ", width = 4, height = 4, units = 'in', res = 100)

NEURO_VD_DD_TILE_plot <- ggplot(NEURO_VD_OD_TILE_count, aes(VAX_DATE, ONSET_DATE)) + geom_tile(aes(fill = n)) + scale_fill_gradient('n', low = "blue", high = "red") + theme(panel.background = element_rect(fill = "black", color = 'black')) + ylab("ONSET OF AEs") + xlab("VACCINE DATE") + theme(panel.grid=element_blank()) + theme(axis.text.x = element_text(colour = "#000000", size = 14)) + theme(axis.text.y = element_text(colour = "#000000", size = 14), axis.text.x=element_text(angle=0,vjust=0.5,hjust=0.5)) + ggtitle("VACCINE DATE vs NEUROLOGICAL AE ONSET DATE") 
NEURO_VD_DD_TILE_plot
```
Plot showing OBSERVED (orange) vs. EXPECTED (yellow) percentages of specific time-frames between Vaccination Date and Onset Date of Immunological Adverse Event
```{r}
IMMUNO_new <- data.frame(IMMUNO, stringsAsFactors = FALSE) %>% filter(year(ONSET_DATE) <= 2021 & year(ONSET_DATE) >= 2020) 
MERGED_SYM_DAT_VAX_05_21_21_151700kb_IMMUNO_VD_OD <- IMMUNO_new %>% mutate("diff_in_days" = difftime(ONSET_DATE, VAX_DATE, units = "days")) %>% filter(diff_in_days >= 0 & diff_in_days <=50) %>% count(diff_in_days) %>% arrange(desc(n))  %>% mutate("OBSERVED" = n) %>% mutate("Percentage_OBSERVED" = n/nrow(IMMUNO_new)*100) %>% mutate("EXPECTED" = mean(n)) %>% mutate("EXPECTED" = mean(n)) %>% mutate("Percentage_EXPECTED" = EXPECTED/nrow(IMMUNO_new)*100)
#head(MERGED_SYM_DAT_VAX_05_21_21_151700kb_IMMUNO_VD_OD)

#chisq.test(MERGED_SYM_DAT_VAX_05_21_21_151700kb_IMMUNO_VD_OD$OBSERVED)
```
```{r}
#png("CAUSATION_IMMUNO_plot", width = 4, height = 4, units = 'in', res = 100)

CAUSATION_IMMUNO_plot <- ggplot() + geom_line(data = MERGED_SYM_DAT_VAX_05_21_21_151700kb_IMMUNO_VD_OD, aes(diff_in_days, Percentage_OBSERVED), colour = "orange", size = 2) + xlab("NUMBER OF DAYS FOLLOWING INJECTION") +  ylab("PERCENTAGE OF REPORTED IMMUNO AEs") + geom_line(data = MERGED_SYM_DAT_VAX_05_21_21_151700kb_IMMUNO_VD_OD, aes(diff_in_days, Percentage_EXPECTED), colour = "yellow", size = 2) + labs(title = "IMMUNOLOGICAL AEs post injection", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 14)) + theme(panel.background = element_rect(fill = "#100000", color = "pink")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
CAUSATION_IMMUNO_plot
```
HEATMAP showing correlation between Vaccine Date and Onset Date for Immunological Adverse Events
```{r}
IMMUNO_VD_OD_TILE_count <- IMMUNO_new %>% group_by(IMMUNOLOGICAL, ONSET_DATE, VAX_DATE) %>% filter(year(ONSET_DATE) <= 2021 & year(ONSET_DATE) >= 2021) %>% filter(year(VAX_DATE) <= 2021 & year(VAX_DATE) >= 2021)%>% mutate("diff_in_days" = difftime(ONSET_DATE, VAX_DATE, units = "days")) %>% filter(diff_in_days >= 0 & diff_in_days <=50) %>% count(diff_in_days) 

#png("IMMUNO_VD_DD_TILE_plot", width = 4, height = 4, units = 'in', res = 100)

IMMUNO_VD_DD_TILE_plot <- ggplot(IMMUNO_VD_OD_TILE_count, aes(VAX_DATE, ONSET_DATE)) + geom_tile(aes(fill = n)) + scale_fill_gradient('n', low = "blue", high = "red") + theme(panel.background = element_rect(fill = "black", color = 'black')) + ylab("ONSET OF AEs") + xlab("VACCINE DATE") + theme(panel.grid=element_blank()) + theme(axis.text.x = element_text(colour = "#000000", size = 14)) + theme(axis.text.y = element_text(colour = "#000000", size = 14), axis.text.x=element_text(angle=0,vjust=0.5,hjust=0.5)) + ggtitle("VACCINE DATE vs IMMUNOLOGICAL AE ONSET DATE") 
IMMUNO_VD_DD_TILE_plot
```
```{r}
AGE_GROUPS_D <- D %>% rowwise() %>% filter(AGE_YRS != "NA") %>% mutate("AGE_GROUP" = AGE_GROUPED_BY_DECADE(AGE_YRS))
AGE_GROUPS_CV_new <- CV_new %>% rowwise() %>% filter(AGE_YRS != "NA") %>% mutate("AGE_GROUP" = AGE_GROUPED_BY_DECADE(AGE_YRS))
AGE_GROUPS_NEURO_new <- NEURO_new %>% rowwise() %>% filter(AGE_YRS != "NA") %>% mutate("AGE_GROUP" = AGE_GROUPED_BY_DECADE(AGE_YRS))
AGE_GROUPS_IMMUNO_new <- IMMUNO_new %>% rowwise() %>% filter(AGE_YRS != "NA") %>% mutate("AGE_GROUP" = AGE_GROUPED_BY_DECADE(AGE_YRS))
```
Histograms to show distributions by age group in Death, Hospital, ER, CV, Neuro and Immuno AE groups
```{r}
#png("AGE_GROUPS_D_ALL_ID_plot", width = 4, height = 4, units = 'in', res = 100)

AGE_GROUPS_D_ALL_ID <- AGE_GROUPS_D %>% group_by(AGE_GROUP) %>% filter(AGE_GROUP != "NA") %>% count(AGE_GROUP)
AGE_GROUPS_D_ALL_ID_plot <- ggplot(AGE_GROUPS_D_ALL_ID, aes(AGE_GROUP, n, fill = AGE_GROUP)) + geom_bar(stat = "Identity") + geom_text(aes(label = n)) + xlab("AGE GROUPS") + ylab("NUMBER OF DEATHS") + theme(axis.text.y = element_text(colour = "black", size = 12)) + theme(axis.text.x = element_text(colour = "black", angle=25,vjust=0.5,hjust=0.5, size = 8)) + theme(legend.position = "none") + ggtitle("Death -> VAERS IDs vs AGE GROUPS")
AGE_GROUPS_D_ALL_ID_plot
AGE_GROUPS_D_ALL_ID_skew <- data.frame(AGE_GROUPS_D_ALL_ID, stringsAsFactors = FALSE) %>% mutate("skew" = 3*(mean(n)-median(n))/(sd(n)))
#AGE_GROUPS_D_ALL_ID_skew
```
```{r}
#png("AGE_GROUPS_CV_ALL_ID_plot", width = 4, height = 4, units = 'in', res = 100)

AGE_GROUPS_CV_ALL_ID <- AGE_GROUPS_CV_new %>% group_by(AGE_GROUP) %>% filter(AGE_GROUP != "NA") %>% count(AGE_GROUP)
AGE_GROUPS_CV_ALL_ID_plot <- ggplot(AGE_GROUPS_CV_ALL_ID, aes(AGE_GROUP, n, fill = AGE_GROUP)) + geom_bar(stat = "Identity") + geom_text(aes(label = n)) + xlab("AGE GROUPS") + ylab("NUMBER OF CARDIOVASCULAR AEs") + theme(axis.text.y = element_text(colour = "black", size = 12)) + theme(axis.text.x = element_text(colour = "black", angle=25,vjust=0.5,hjust=0.5, size = 8)) + theme(legend.position = "none") + ggtitle("Cardiovascular Events -> VAERS IDs vs AGE GROUPS")
AGE_GROUPS_CV_ALL_ID_plot
AGE_GROUPS_CV_ALL_ID_skew <- data.frame(AGE_GROUPS_CV_ALL_ID, stringsAsFactors = FALSE) %>% mutate("skew" = 3*(mean(n)-median(n))/(sd(n)))
#AGE_GROUPS_CV_ALL_ID_skew
```
```{r}
#png("AGE_GROUPS_NEURO_ALL_ID_plot", width = 4, height = 4, units = 'in', res = 100)

AGE_GROUPS_NEURO_ALL_ID <- AGE_GROUPS_NEURO_new %>% group_by(AGE_GROUP) %>% filter(AGE_GROUP != "NA") %>% count(AGE_GROUP)
AGE_GROUPS_NEURO_ALL_ID_plot <- ggplot(AGE_GROUPS_NEURO_ALL_ID, aes(AGE_GROUP, n, fill = AGE_GROUP)) + geom_bar(stat = "Identity") + geom_text(aes(label = n)) + xlab("AGE GROUPS") + ylab("NUMBER OF NEUROLOGICAL AEs") + theme(axis.text.y = element_text(colour = "black", size = 12)) + theme(axis.text.x = element_text(colour = "black", angle=25,vjust=0.5,hjust=0.5, size = 8)) + theme(legend.position = "none") + ggtitle("Neurological Events -> VAERS IDs vs AGE GROUPS")
AGE_GROUPS_NEURO_ALL_ID_plot
AGE_GROUPS_NEURO_ALL_ID_skew <- data.frame(AGE_GROUPS_NEURO_ALL_ID, stringsAsFactors = FALSE) %>% mutate("skew" = 3*(mean(n)-median(n))/(sd(n)))
#AGE_GROUPS_NEURO_ALL_ID_skew
```
```{r}
#png("AGE_GROUPS_IMMUNO_ALL_ID_plot", width = 4, height = 4, units = 'in', res = 100)

AGE_GROUPS_IMMUNO_ALL_ID <- AGE_GROUPS_IMMUNO_new %>% group_by(AGE_GROUP) %>% filter(AGE_GROUP != "NA") %>% count(AGE_GROUP)
AGE_GROUPS_IMMUNO_ALL_ID_plot <- ggplot(AGE_GROUPS_IMMUNO_ALL_ID, aes(AGE_GROUP, n, fill = AGE_GROUP)) + geom_bar(stat = "Identity") + geom_text(aes(label = n)) + xlab("AGE GROUPS") + ylab("NUMBER OF IMMUNOLOGICAL AEs") + theme(axis.text.y = element_text(colour = "black", size = 12)) + theme(axis.text.x = element_text(colour = "black", angle=25,vjust=0.5,hjust=0.5, size = 8)) + theme(legend.position = "none") + ggtitle("Immunological Events -> VAERS IDs vs AGE GROUPS")
AGE_GROUPS_IMMUNO_ALL_ID_plot
AGE_GROUPS_IMMUNO_ALL_ID_skew <- data.frame(AGE_GROUPS_IMMUNO_ALL_ID, stringsAsFactors = FALSE) %>% mutate("skew" = 3*(mean(n)-median(n))/(sd(n)))
#AGE_GROUPS_IMMUNO_ALL_ID_skew
```
```{r}
Table_IDs_percent <- data.frame(
  DATE = as.Date(c("1/16/21", "1/23/21", "1/30/21", "2/13/21", "2/27/21", "3/5/21", "3/12/21", "3/19/21", "3/26/21", "4/2/21", "4/9/21", "4/16/21", "4/23/21", "4/30/21", "5/7/21", "5/14/21", "5/21/21"), "%m/%d/%y"),
  IDs = as.numeric(c("1431", "2160", "2946", "5351", "9286", "14701", "20586", "27955", "34121", "40348", "46163", "57641", "75370", "108191", "146622", "182559", "217716")),
  FV = as.numeric(c("4582089", "7664179", "11037313", "18895522", "27167910", "31720149", "35000000", "44145522", "48700000", "57980000", "64420000", "80610000", "89250000", "99670000", "108930000", "118990000", "126610000")),
  US_population = as.numeric(c("330175152" , "330175733" , "330176314", "330176895", "330177476", "330178057", "330178638", "330179219", "330179800", "330180381", "330193928", "330209443", "330244315", "330239326", "330757983", "332700813", "332738974")),
  DEATH = as.numeric(c("137", "281", "456", "810", "984", "1162", "1419", "1561", "1957", "2149", "2240", "2500", "3084", "3442", "3731", "4015", "4169")),
  HOSPITAL = as.numeric(c("338", "607", "953", "1747", "2195", "2676", "3412", "3913", "4387", "4758", "4906", "5009", "6215", "8099", "10648", "11557", "12625")), 
  ER = as.numeric(c("338", "576", "847", "1493", "2187", "2980", "3855", "4763", "5529", "6329", "6983", "8084", "10375", "14553", "19620", "23641", "27774")),
  SAE = as.numeric(c("625", "1101", "1668", "2977", "4017", "5193", "6648", "8000", "9268", "10350", "10484", "12464", "15713", "21158", "27642", "32277", "37000")),
  COVID = as.numeric(c("194", "254", "326", "619", "717", "776", "943", "1057", "1169", "1267", "1375", "1404", "1587", "1930", "2776", "3317", "3742")), 
  CV = as.numeric(c("271", "417", "586", "1088", "1794", "2707", "3768", "5049", "6079", "7200", "8194", "9872", "12999", "18834", "25254", "31437", "37577")),
  NEURO = as.numeric(c("157", "223", "307", "538", "963", "1583", "2347", "3370", "4024", "4706", "5303", "6413", "8122", "11693", "15741", "19493", "23358")),
  IMMUNO = as.numeric(c("310", "425", "523", "930", "2360", "4533", "6406", "9150", "11663", "14041", "16480", "21146", "28070", "40021", "54723", "68836", "81954")),
  
  stringsAsFactors = FALSE
)
#Table_IDs_percent
```
```{r}
SAE_calculations <- Table_IDs_percent %>% mutate("SAE_p_FV" = SAE/(FV/1000000)) %>% mutate("SAE_p_mill_doses" = SAE_p_FV/(2.21)) #cum num of doses/FV population = 279400000/126610000 = 2.21
#SAE_calculations
```
```{r}
IDs = as.numeric(c("1431", "2160", "2946", "5351", "9286", "14701", "20586", "27955", "34121", "40348", "46163", "57641", "75370", "108191", "146622", "182559", "217716"))
#(diff(IDs)/(IDs))*100
```
```{r}
Table_IDs_percent_FV_IDs <- Table_IDs_percent %>% mutate("DEATH_PERCENT_ID" = DEATH/IDs*100) %>% mutate("H_PERCENT_ID" = HOSPITAL/IDs*100) %>% mutate("ER_PERCENT_ID" = ER/IDs*100) %>% mutate("SAE_PERCENT_ID" = SAE/IDs*100) %>% mutate("COVID_PERCENT_ID" = COVID/IDs*100) %>% mutate("CV_PERCENT_ID" = CV/IDs*100) %>% mutate("NEURO_PERCENT_ID" = NEURO/IDs*100) %>% mutate("IMMUNO_PERCENT_ID" = IMMUNO/IDs*100) %>% mutate("DEATH_PERCENT_FV" = DEATH/FV*100) %>% mutate("H_PERCENT_FV" = HOSPITAL/FV*100) %>% mutate("ER_PERCENT_FV" = ER/FV*100) %>% mutate("SAE_PERCENT_FV" = SAE/FV*100) %>% mutate("COVID_PERCENT_FV" = COVID/FV*100) %>% mutate("CV_PERCENT_FV" = CV/FV*100) %>% mutate("NEURO_PERCENT_FV" = NEURO/FV*100) %>% mutate("IMMUNO_PERCENT_FV" = IMMUNO/FV*100)
#Table_IDs_percent_FV_IDs
```
```{r} 
IDs_normalized_total_IDs <- Table_IDs_percent %>% mutate("IDs_normal_ID" = IDs/nrow(MERGED_SYM_DAT_VAX_05_21_21_151700kb)*100)
#IDs_normalized_total_IDs
```
```{r}
Table_IDs_percent_normalized_US_pop <- Table_IDs_percent_FV_IDs %>% mutate("IDs_norm_US_pop" = IDs/(US_population/1000000)) 
#Table_IDs_percent_normalized_US_pop

Table_IDs_percent_normalized_FV <- Table_IDs_percent_FV_IDs %>% mutate("IDs_norm_FV" = IDs/(FV/1000000)) 
#Table_IDs_percent_normalized_FV

Table_AEs_percent_normalized_per_million <- Table_IDs_percent_FV_IDs %>% mutate("Death_norm_per_million" = DEATH/(FV/1000000)) %>% mutate("Hospital_norm_per_million" = HOSPITAL/(FV/1000000)) %>% mutate("ER_norm_per_million" = ER/(FV/1000000)) %>% mutate("SAE_norm_per_million" = SAE/(FV/1000000)) %>% mutate("COVID_norm_per_million" = COVID/(FV/1000000)) %>% mutate("CV_norm_per_million" = CV/(FV/1000000)) %>% mutate("NEURO_norm_per_million" = NEURO/(FV/1000000)) %>% mutate("IMMUNO_norm_per_million" = IMMUNO/(FV/1000000))
#Table_AEs_percent_normalized_per_million
```
```{r}
Table_IDs_all_VAERS <- data.frame(
  DATE = as.double(c("1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021")),
  IDs = as.numeric(c("2787", "16657", "18392", "17655", "18441", "17794", "17592", "17247", "15997", "20072", "23113", "25492", "26852", "31248", "28663", "28664", "31353", "48349", "51019", "50524", "49601", "41200", "41149", "43335", "47165", "57224", "60450", "52751", "62305", "61204", "55833", "62000")),
  US_Pop = as.numeric(c("252120309", "254539370", "256990613", "259532129", "262241196", "265163745", "268335003" ,"271713635", "275175301", "278548150", "281710909", "284607993", "287279318", "289815562", "292354658", "294993511", "297758969", "300608429", "303486012", "306307567", "309011475", "311584047", "314043885", "316400538", "318673411", "320878310" ,"323015995", "325084756", "327096265", "329064917", "331002651", "332915073")),
  
  stringsAsFactors = FALSE
)
Table_IDs_all_VAERS <- Table_IDs_all_VAERS %>% mutate("NORMALIZED" = IDs/(US_Pop/1000000))
#Table_IDs_all_VAERS
```
```{r}
Table_IDs_all_VAERS_plot <- ggplot(data = Table_IDs_all_VAERS, aes(DATE, IDs, colour = "IDs")) + geom_line(data = Table_IDs_all_VAERS, aes(DATE, IDs, colour = "IDs"), colour = "red", size = 2) + geom_point(data = Table_IDs_all_VAERS, aes(DATE, IDs, colour = "IDs"), colour = "red", size = 5) + xlab("DATE") + ylab("ABSOLUTE NUMBER OF VAERS IDs (N)") + labs(title = "Change in absolute number of VAERS IDs per year", caption = "Data source: VAERS", size = 12) + theme(axis.text.y = element_text(colour = "#000000", size = 14)) + theme(axis.text.x = element_text(angle=0,vjust=0.5,hjust=0.5, size = 14)) + theme(panel.background = element_rect(fill = "#100000")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + theme(legend.title=element_blank()) + theme(legend.background = element_rect(fill = "white"), legend.key = element_rect(fill = "black", color = NA), legend.key.size = unit(0.5, "cm"), legend.key.width = unit(0.5,"cm")) + geom_smooth(method = "lm", se=FALSE, color="blue", aes(group=1))
#Table_IDs_all_VAERS_plot
```
VAERS ID COUNTS NORMALIZED TO U.S. POPULATION
```{r}
#png("Table_IDs_all_VAERS_plot_norm_US.png", width = 4, height = 4, units = 'in', res = 100)

Table_IDs_all_VAERS_plot_norm_US <- ggplot(data = Table_IDs_all_VAERS, aes(DATE, NORMALIZED, colour = "NORMALIZED")) + geom_line(data = Table_IDs_all_VAERS, aes(DATE, NORMALIZED, colour = "NORMALIZED"), colour = "red", size = 2) + geom_point(data = Table_IDs_all_VAERS, aes(DATE, NORMALIZED, colour = "NORMALIZED"), colour = "red", size = 5) + xlab("DATE") +  ylab("VAERS ID rate normalized to U.S. popln/million") + labs(title = "VAERS ADVERSE EVENT COUNTS OVER THE YEARS", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 14)) + theme(panel.background = element_rect(fill = "#100000")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + theme(legend.title=element_blank()) + theme(legend.background = element_rect(fill = "white"), legend.key = element_rect(fill = "black", color = NA), legend.key.size = unit(0.5, "cm"), legend.key.width = unit(0.5,"cm")) + geom_smooth(method = "lm", se=FALSE, color="blue", aes(group=1)) #+ geom_text(aes(label = IDs), color = "white", size = 4) 
Table_IDs_all_VAERS_plot_norm_US
```
CUMULATIVE NUMBER OF ADVERSE EVENTS
```{r}
#png("Table_IDs_plot.png", width = 4, height = 4, units = 'in', res = 100)

Table_IDs_plot <- ggplot(data = Table_IDs_percent, aes(x = DATE, y = IDs)) + geom_line(data = Table_IDs_percent, aes(x = DATE, y = IDs, colour = "IDs"), colour = "red", size = 2) + geom_point(data = Table_IDs_percent, aes(DATE, IDs, colour = "IDs"), colour = "red", size = 5) + xlab("DATE") +  ylab("Absolute number of VAERS IDs (N)") + labs(title = "CUMULATIVE COVID-19 PRODUCT-RELATED VAERS AES", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=15,vjust=0.5,hjust=0.5, size = 10)) + theme(panel.background = element_rect(fill = "black")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + theme(legend.title=element_blank()) + scale_x_continuous(breaks = round(seq(min(Table_IDs_percent$DATE), max(Table_IDs_percent$DATE), by = 10),0.1)) #+ ylim(0,200000)
Table_IDs_plot
```
CUMULATIVE NUMBER OF ADVERSE EVENTS AS PER AE GROUP
```{r}
#png("Table_IDs_percent_plot", width = 4, height = 4, units = 'in', res = 100)

Table_IDs_percent_plot <- ggplot() + geom_line(data = Table_IDs_percent_FV_IDs, aes(DATE, DEATH, colour = "DEATH"), size = 2) + xlab("DATE") +  ylab("Absolute number of VAERS IDs (N)") + geom_line(data = Table_IDs_percent_FV_IDs, aes(DATE, HOSPITAL, colour = "HOSPITAL"), size = 2) + geom_line(data = Table_IDs_percent_FV_IDs, aes(DATE, ER, colour = "ER"), size = 2) + geom_line(data = Table_IDs_percent_FV_IDs, aes(DATE, CV, colour = "CV"), size = 2) + geom_line(data = Table_IDs_percent_FV_IDs, aes(DATE, NEURO, colour = "NEURO"), size = 2) + geom_line(data = Table_IDs_percent, aes(DATE, IMMUNO, colour = "IMMUNO"), size = 2) + labs(title = "CUMULATIVE COVID-19 PRODUCT-RELATED GROUPED AES", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 14)) + theme(panel.background = element_rect(fill = "#100000")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + theme(legend.title=element_blank()) + theme(legend.background = element_rect(fill = "white"), legend.key = element_rect(fill = "black", color = NA), legend.key.size = unit(0.5, "cm"), legend.key.width = unit(0.5,"cm")) 
Table_IDs_percent_plot
```
CUMULATIVE NUMBER OF VAERS IDS AS PER AE GROUP PER MILLION FULLY VAXXED (FV)
```{r}
#png("Table_IDs_FV_per_million", width = 4, height = 4, units = 'in', res = 100)

Table_IDs_FV_per_million <- ggplot() + geom_line(data = Table_AEs_percent_normalized_per_million, aes(DATE, Death_norm_per_million, colour = "DEATH"), size = 2) + xlab("DATE") +  ylab("Grouped adverse events per million FV") + geom_line(data = Table_AEs_percent_normalized_per_million, aes(DATE, Hospital_norm_per_million, colour = "HOSPITAL"), size = 2) + geom_line(data = Table_AEs_percent_normalized_per_million, aes(DATE, ER_norm_per_million, colour = "ER"), size = 2) + geom_line(data = Table_AEs_percent_normalized_per_million, aes(DATE, CV_norm_per_million, colour = "CV"), size = 2) + geom_line(data = Table_AEs_percent_normalized_per_million, aes(DATE,NEURO_norm_per_million, colour = "NEURO"), size = 2) + geom_line(data = Table_AEs_percent_normalized_per_million, aes(DATE, IMMUNO_norm_per_million, colour = "IMMUNO"), size = 2) + labs(title = "VAERS AES PER MILLION FULLY VAXXED (FV)", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 12)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 12)) + theme(panel.background = element_rect(fill = "#100000")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + theme(legend.title=element_blank()) + theme(legend.background = element_rect(fill = "white"), legend.key = element_rect(fill = "black", color = NA), legend.key.size = unit(0.5, "cm"), legend.key.width = unit(0.5,"cm"))
Table_IDs_FV_per_million
```
THE FOLLOWING IS A NEW ADVERSE EVENT GROUP THAT I CREATED BY WRITING A FUNCTION THAT PULLS OUT AES BY KEYWORD. THIS NEW AE GROUP INCLUDED FEMALE REPRODUCTIVE ISSUES THAT OCCURRED IN WOMEN POST-INJECTION.
```{r}
strings_FRI <- c("Abnormal uterine bleeding", "Afterbirth pain", "Dysmenorrhoea", "Female reproductive tract disorder", "Female sex hormone level", "Female reproductive tract disorder", "Alpha 1 foetoprotein abnormal", "Heavy menstrual bleeding", "Intermenstrual bleeding", "Intra-uterine contraceptive device removal", "Menstrual disorder", "Menstruation delayed", "Menstruation irregular", "Premenstrual syndrome", "Abortion spontaneous", "Abortion spontaneous incomplete", "Uterine leiomyoma", "Uterine haemorrhage", "Uterine spasm", "Bradycardia foetal", "Biopsy foetal", "Bradycardia foetal", "Foetal cystic hygroma", "Foetal death", "Foetal exposure during pregnancy", "Foetal heart rate abnormal", "Foetal hypokinesia", "Foetal non-stress test abnormal", "Female sex hormone level", "Amenorrhoea", "Hypomenorrhoea", "Menopause", "Menorrhagia", "Oligomenorrhoea", "Polymenorrhoea", "Postmenopausal haemorrhage", "Postmenopause", "Vaginal discharge", "Vaginal disorder", "Vaginal erosion", "Vaginal haemorrhage", "Vaginal lesion", "Vaginal infection", "Vulvovaginal mycotic infection", "Vulval ulceration", "Vulval abscess", "Vulva cyst", "Cervix inflammation", "Adenocarcinoma of the cervix", "Cervix carcinoma", "Amniorrhoea", "Amniotic cavity infection", "Amniotic membrane rupture test positive", "Amniotic fluid index decreased")
```
```{r}
FRI <- function(SYMPTOM) {
  if(str_detect(SYMPTOM, paste(strings_FRI, collapse = "|"))) {
      FRI = "Female_Reprod_Issues"
      } 
        else {
          FRI = "NA"
      }
    return(FRI)
}
```
```{r}
FRI_CASES <- MERGED_SYM_DAT_VAX_05_21_21_151700kb %>% rowwise() %>% filter(SYMPTOM != "NA") %>% mutate("Female_Reprod_Issues" = FRI(SYMPTOM)) %>% filter(Female_Reprod_Issues != "NA")
```
```{r}
nrow(FRI_CASES)
```
```{r}
FRI_CASES_AG <- FRI_CASES %>% rowwise() %>% filter(AGE_YRS != "NA") %>% mutate("AGE_GROUP" = AGE_GROUPED_BY_DECADE(AGE_YRS))
FRI_CASES_AG_count <- FRI_CASES_AG %>% group_by(AGE_GROUP) %>% filter(AGE_GROUP != "NA") %>% count(AGE_GROUP)
FRI_CASES_AG_plot <- ggplot(FRI_CASES_AG_count, aes(AGE_GROUP, n, fill = AGE_GROUP)) + geom_bar(stat = "Identity") + geom_text(aes(label = n)) + xlab("AGE GROUPS") + ylab("NUMBER OF FRI AEs") + theme(axis.text.y = element_text(colour = "black", size = 12)) + theme(axis.text.x = element_text(colour = "black", angle=25,vjust=0.5,hjust=0.5, size = 8)) + theme(legend.position = "none") + ggtitle("Female Reproductive Issues -> VAERS IDs vs AGE GROUPS")
FRI_CASES_AG_plot
FRI_CASES_AG_plot_skew <- data.frame(FRI_CASES_AG_count, stringsAsFactors = FALSE) %>% mutate("skew" = 3*(mean(n)-median(n))/(sd(n)))
#FRI_CASES_AG_plot_skew
```
```{r}
FRI_new <- data.frame(FRI_CASES, stringsAsFactors = FALSE) %>% filter(year(ONSET_DATE) <= 2021 & year(ONSET_DATE) >= 2020) 
MERGED_SYM_DAT_VAX_05_21_21_151700kb_FRI_new_VD_OD <- FRI_new %>% mutate("diff_in_days" = difftime(ONSET_DATE, VAX_DATE, units = "days")) %>% filter(diff_in_days >= 0 & diff_in_days <=50) %>% count(diff_in_days) %>% arrange(desc(n))  %>% mutate("OBSERVED" = n) %>% mutate("Percentage_OBSERVED" = n/nrow(FRI_new)*100) %>% mutate("EXPECTED" = mean(n)) %>% mutate("EXPECTED" = mean(n)) %>% mutate("Percentage_EXPECTED" = EXPECTED/nrow(FRI_new)*100)
#head(MERGED_SYM_DAT_VAX_05_21_21_151700kb_FRI_new_VD_OD)

#chisq.test(MERGED_SYM_DAT_VAX_05_21_21_151700kb_FRI_new_VD_OD$OBSERVED)
```
```{r}
#png("CAUSATION_IMMUNO_plot", width = 4, height = 4, units = 'in', res = 100)

CAUSATION_FRI_new_plot <- ggplot() + geom_line(data = MERGED_SYM_DAT_VAX_05_21_21_151700kb_FRI_new_VD_OD, aes(diff_in_days, Percentage_OBSERVED), colour = "orange", size = 2) + xlab("NUMBER OF DAYS FOLLOWING INJECTION") +  ylab("PERCENTAGE OF REPORTED FRI AEs") + geom_line(data = MERGED_SYM_DAT_VAX_05_21_21_151700kb_FRI_new_VD_OD, aes(diff_in_days, Percentage_EXPECTED), colour = "yellow", size = 2) + labs(title = "Female Reproductive Issues post injection", caption = "Data source: VAERS") + theme(axis.text.y = element_text(colour = "black", size = 14)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 14)) + theme(panel.background = element_rect(fill = "#100000", color = "pink")) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
CAUSATION_FRI_new_plot
```
```{r}
MERGED_SYM_DAT_VAX_05_21_21_151700kb_FEM <- MERGED_SYM_DAT_VAX_05_21_21_151700kb %>% filter(SEX == "F") 
#nrow(MERGED_SYM_DAT_VAX_05_21_21_151700kb_FEM)
FRI_CASES_perc <- FRI_CASES %>% count(SYMPTOM) %>% arrange(desc(n)) %>% mutate("PERC" = n/nrow(MERGED_SYM_DAT_VAX_05_21_21_151700kb_FEM)*100)
#FRI_CASES_perc
```
```{r}
FRI_CASES_count_plot <- ggplot(FRI_CASES_perc, aes(n, SYMPTOM, fill = SYMPTOM)) + geom_bar(stat = "Identity") + geom_text(aes(label = n)) + ylab("SYMPTOM") + xlab("Number of Female Reproductive Disorders") + theme(axis.text.y = element_text(colour = "black", size = 6)) + theme(axis.text.x = element_text(colour = "black", angle=0,vjust=0.5,hjust=0.5, size = 10)) + theme(legend.position = "none") + ggtitle("Numbers of Female Reproductive Adverse Event types")
FRI_CASES_count_plot
```